(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[133],{4223:function(e,t,r){Promise.resolve().then(r.bind(r,2626))},1227:function(e,t,r){"use strict";r.d(t,{Z:function(){return o}});var a=r(3827),s=r(4090),n=r(5810);function o(e){let{isOpen:t,onClose:r,onSuccess:o}=e,[i,l]=(0,s.useState)(""),[d,c]=(0,s.useState)(!1),[u,g]=(0,s.useState)(""),h=async e=>{e.preventDefault(),c(!0),g("");try{await (0,n.Gw)(i)?o(i):g("API Key无效,请重试")}catch(e){g("验证失败,请重试")}finally{c(!1)}};return t?(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4 text-gray-900 dark:text-white",children:"请输入API Key"}),(0,a.jsxs)("form",{onSubmit:h,children:[(0,a.jsx)("input",{type:"password",value:i,onChange:e=>l(e.target.value),className:"w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:"输入您的API Key",required:!0}),u&&(0,a.jsx)("p",{className:"text-red-500 mb-4",children:u}),(0,a.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,a.jsx)("button",{type:"button",onClick:r,className:"px-4 py-2 text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-white",children:"取消"}),(0,a.jsx)("button",{type:"submit",disabled:d,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50",children:d?"验证中...":"验证"})]})]})]})}):null}},2626:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return u}});var a=r(3827),s=r(4090),n=r(8792),o=r(703),i=r(5810);async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=(0,i.Pi)();if(!r)throw Error("未设置API Key");let{params:a,...s}=t,n=new URL(e,"");a&&Object.entries(a).forEach(e=>{let[t,r]=e;n.searchParams.append(t,r)});let o={Authorization:"Bearer ".concat(r),...t.headers},l=await fetch(n.toString(),{...s,headers:o});if(!l.ok)throw Error((await l.json().catch(()=>({}))).message||"请求失败");return l.json()}let d={get:(e,t)=>l(e,{method:"GET",params:t}),post:(e,t)=>l(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),delete:e=>l(e,{method:"DELETE"}),upload:(e,t)=>{let r=new FormData;return t.forEach(e=>{r.append("images[]",e)}),l(e,{method:"POST",body:r})}};var c=r(1227);function u(){let[e,t]=(0,s.useState)(!0),[r,l]=(0,s.useState)(!1),[u,g]=(0,s.useState)([]),[h,m]=(0,s.useState)(!0),[x,p]=(0,s.useState)(null);(0,s.useEffect)(()=>{document.documentElement.classList.add("dark"),(async()=>{let e=(0,i.Pi)();if(!e){l(!0);return}if(!await (0,i.Gw)(e)){l(!0),p({type:"error",message:"API Key无效,请重新验证"});return}y()})()},[]);let y=async()=>{try{let e=await d.get("/api/images");g(e.images)}catch(e){p({type:"error",message:"加载图片列表失败"})}finally{m(!1)}},f=async e=>{try{await d.delete("/api/images/".concat(e)),g(u.filter(t=>t.id!==e)),p({type:"success",message:"删除成功"})}catch(e){p({type:"error",message:"删除失败"})}};return(0,a.jsxs)("div",{className:"max-w-6xl mx-auto px-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-10",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(n.default,{href:"/",className:"mr-4",children:(0,a.jsx)("div",{className:"logo-gradient w-14 h-14 rounded-2xl flex items-center justify-center shadow-lg transform rotate-12",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})})}),(0,a.jsx)("h1",{className:"text-4xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-indigo-500 to-purple-600 dark:from-indigo-400 dark:to-purple-500",children:"图片管理"})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("button",{onClick:()=>l(!0),className:"p-2 mr-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-gray-700 dark:text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"})})}),(0,a.jsx)("button",{onClick:()=>{t(!e),document.documentElement.classList.toggle("dark")},className:"p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:e?(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-amber-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})}):(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-gray-700",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})})})]})]}),x&&(0,a.jsx)("div",{className:"mb-8 p-4 rounded-xl ".concat("success"===x.type?"bg-green-50 dark:bg-green-900 text-green-700 dark:text-green-300":"bg-red-50 dark:bg-red-900 text-red-700 dark:text-red-300"),children:x.message}),h?(0,a.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-500"})}):(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:u.map(e=>(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden",children:[(0,a.jsxs)("div",{className:"relative aspect-square",children:[(0,a.jsx)(o.default,{src:e.url,alt:e.filename,fill:!0,className:"object-cover"}),(0,a.jsx)("button",{onClick:()=>f(e.id),className:"absolute top-2 right-2 bg-red-500 text-white p-2 rounded-full hover:bg-red-600 transition-colors",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 truncate",children:e.filename}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:[(e.size/1024/1024).toFixed(2)," MB"]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-500",children:new Date(e.created_at).toLocaleString()})]})]},e.id))}),(0,a.jsx)(c.Z,{isOpen:r,onClose:()=>l(!1),onSuccess:e=>{(0,i.Lb)(e),l(!1),p({type:"success",message:"API Key验证成功！"}),y()}})]})}},5810:function(e,t,r){"use strict";r.d(t,{Gw:function(){return o},Lb:function(){return n},Pi:function(){return s}});let a="imageflow_api_key",s=()=>localStorage.getItem(a),n=e=>{localStorage.setItem(a,e)},o=async e=>{try{let t=await fetch("/validate-api-key",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}),r=await t.json();return!0===r.valid}catch(e){return console.error("API Key validation error:",e),!1}}}},function(e){e.O(0,[607,971,69,744],function(){return e(e.s=4223)}),_N_E=e.O()}]);