(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[133],{1237:function(e,t,r){Promise.resolve().then(r.bind(r,4046))},4046:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return V}});var a=r(7437),s=r(2265),i=Object.defineProperty,l=new Map,o=new WeakMap,n=0,d=void 0;s.Component;var c=r(9597);function u(){return(u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,a)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach(function(t){var a;a=r[t],t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}class x extends s.Component{constructor(e){let t;super(e),this.reCalculateColumnCount=this.reCalculateColumnCount.bind(this),this.reCalculateColumnCountDebounce=this.reCalculateColumnCountDebounce.bind(this),t=this.props.breakpointCols&&this.props.breakpointCols.default?this.props.breakpointCols.default:parseInt(this.props.breakpointCols)||2,this.state={columnCount:t}}componentDidMount(){this.reCalculateColumnCount(),window&&window.addEventListener("resize",this.reCalculateColumnCountDebounce)}componentDidUpdate(){this.reCalculateColumnCount()}componentWillUnmount(){window&&window.removeEventListener("resize",this.reCalculateColumnCountDebounce)}reCalculateColumnCountDebounce(){if(!window||!window.requestAnimationFrame){this.reCalculateColumnCount();return}window.cancelAnimationFrame&&window.cancelAnimationFrame(this._lastRecalculateAnimationFrame),this._lastRecalculateAnimationFrame=window.requestAnimationFrame(()=>{this.reCalculateColumnCount()})}reCalculateColumnCount(){let e=window&&window.innerWidth||1/0,t=this.props.breakpointCols;"object"!=typeof t&&(t={default:parseInt(t)||2});let r=1/0,a=t.default||2;for(let s in t){let i=parseInt(s);i>0&&e<=i&&i<r&&(r=i,a=t[s])}a=Math.max(1,parseInt(a)||1),this.state.columnCount!==a&&this.setState({columnCount:a})}itemsInColumns(){let e=this.state.columnCount,t=Array(e),r=s.Children.toArray(this.props.children);for(let a=0;a<r.length;a++){let s=a%e;t[s]||(t[s]=[]),t[s].push(r[a])}return t}renderColumns(){let{column:e,columnAttrs:t={},columnClassName:r}=this.props,a=this.itemsInColumns(),i=`${100/a.length}%`,l=r;l&&"string"!=typeof l&&(this.logDeprecated('The property "columnClassName" requires a string'),void 0===l&&(l="my-masonry-grid_column"));let o=m(m(m({},e),t),{},{style:m(m({},t.style),{},{width:i}),className:l});return a.map((e,t)=>s.createElement("div",u({},o,{key:t}),e))}logDeprecated(e){console.error("[Masonry]",e)}render(){let e=this.props,{children:t,breakpointCols:r,columnClassName:a,columnAttrs:i,column:l,className:o}=e,n=function(e,t){if(null==e)return{};var r,a,s=function(e,t){if(null==e)return{};var r,a,s={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(s[r]=e[r]);return s}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(s[r]=e[r])}return s}(e,["children","breakpointCols","columnClassName","columnAttrs","column","className"]),d=o;return"string"!=typeof o&&(this.logDeprecated('The property "className" requires a string'),void 0===o&&(d="my-masonry-grid")),s.createElement("div",u({},n,{className:d}),this.renderColumns())}}x.defaultProps={breakpointCols:void 0,className:void 0,columnClassName:void 0,children:void 0,columnAttrs:void 0,column:void 0};var h=r(5017),p=r(6329),f=r(2896),b=r(8614);function y(e){let{onFilterChange:t}=e,[r,i]=(0,s.useState)("original"),[l,o]=(0,s.useState)("all"),[n,d]=(0,s.useState)(""),[u,g]=(0,s.useState)([]),[m,x]=(0,s.useState)(!1),[h,f]=(0,s.useState)(""),y=(0,s.useRef)(null);(0,s.useEffect)(()=>{(async()=>{try{let e=await p.hi.get("/api/tags");e.tags&&e.tags.length>0&&g(e.tags)}catch(e){console.error("获取标签失败:",e)}})()},[]),(0,s.useEffect)(()=>{let e=e=>{y.current&&!y.current.contains(e.target)&&x(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);let w=""===h.trim()?u:u.filter(e=>e.toLowerCase().includes(h.toLowerCase())),v=e=>{i(e),t(e,l,n)},j=e=>{o(e),t(r,e,n)},k=e=>{d(e),t(r,l,e),x(!1)};return(0,a.jsxs)(c.E.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mb-8 bg-white dark:bg-slate-800 rounded-xl p-6 shadow-lg border border-gray-100 dark:border-gray-700",children:[(0,a.jsxs)("h2",{className:"text-lg font-semibold mb-5 flex items-center text-gray-800 dark:text-gray-200",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2 text-indigo-500",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M3 3a1 1 0 011-1h12a1 1 0 011 1v3a1 1 0 01-.293.707L12 11.414V15a1 1 0 01-.293.707l-2 2A1 1 0 018 17v-5.586L3.293 6.707A1 1 0 013 6V3z",clipRule:"evenodd"})}),"筛选图片"]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-6",children:[(0,a.jsxs)("div",{className:"w-full md:w-[calc(50%-0.75rem)]",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-600 dark:text-gray-400 mb-2",children:"文件格式"}),(0,a.jsx)("div",{className:"grid grid-cols-3 sm:grid-cols-5 gap-2",children:["original","webp","avif","gif"].map(e=>(0,a.jsx)(c.E.button,{onClick:()=>v(e),whileTap:{scale:.95},className:"px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200 ".concat(r===e?"bg-gradient-to-r from-indigo-500 to-indigo-600 text-white shadow-md":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"),children:"all"===e?"全部":"original"===e?"原始":e.toUpperCase()},e))})]}),(0,a.jsxs)("div",{className:"w-full md:w-[calc(50%-0.75rem)]",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-600 dark:text-gray-400 mb-2",children:"图片方向"}),(0,a.jsx)("div",{className:"grid grid-cols-3 gap-2",children:["all","landscape","portrait"].map(e=>(0,a.jsx)(c.E.button,{disabled:"gif"===r,onClick:()=>j(e),whileTap:{scale:.95},className:"px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200 ".concat("gif"===r?"opacity-50 cursor-not-allowed bg-gray-100 dark:bg-gray-700 text-gray-400 dark:text-gray-500":l===e?"bg-gradient-to-r from-purple-500 to-purple-600 text-white shadow-md":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"),children:"all"===e?"全部":"landscape"===e?"横向":"纵向"},e))})]}),(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-600 dark:text-gray-400 mb-2",children:"标签分类"}),(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,a.jsx)(c.E.button,{whileTap:{scale:.95},onClick:()=>k(""),className:"px-3 py-2 rounded-full text-sm font-medium transition-all duration-200 flex items-center ".concat(""===n?"bg-gradient-to-r from-indigo-500 to-purple-600 text-white shadow-sm":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"),children:"全部"}),n&&""!==n&&(0,a.jsxs)(c.E.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-3 py-2 rounded-full text-sm font-medium flex items-center shadow-sm",children:[(0,a.jsx)("span",{children:n}),(0,a.jsx)("button",{onClick:()=>k(""),className:"ml-2 rounded-full p-0.5 hover:bg-white/20 transition-colors",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsxs)("div",{className:"relative",ref:y,children:[(0,a.jsxs)(c.E.button,{whileTap:{scale:.95},onClick:()=>{x(!m),f("")},className:"px-3 py-2 rounded-full text-sm font-medium bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-indigo-100 dark:hover:bg-indigo-900/30 transition-all duration-200 flex items-center gap-1",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})}),"选择标签",(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 transition-transform ".concat(m?"rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})]}),(0,a.jsx)(b.M,{children:m&&(0,a.jsxs)(c.E.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.95},transition:{duration:.15},className:"absolute left-0 top-full mt-1 w-64 max-h-80 overflow-y-auto bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 z-50",children:[(0,a.jsx)("div",{className:"p-2 sticky top-0 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"text",value:h,onChange:e=>{f(e.target.value)},placeholder:"搜索标签...",className:"w-full px-3 py-2 pl-9 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-600 text-sm"}),(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]})}),(0,a.jsx)("div",{className:"p-2",children:w.length>0?(0,a.jsx)("div",{className:"grid grid-cols-2 gap-1",children:w.map(e=>(0,a.jsx)(c.E.button,{whileTap:{scale:.95},onClick:()=>k(e),className:"px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200 text-left truncate ".concat(n===e?"bg-indigo-100 dark:bg-indigo-900/30 text-indigo-800 dark:text-indigo-300":"hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300"),children:e},e))}):h?(0,a.jsx)("div",{className:"py-3 text-center text-gray-500 dark:text-gray-400 text-sm",children:"未找到匹配的标签"}):(0,a.jsx)("div",{className:"py-3 text-center text-gray-500 dark:text-gray-400 text-sm",children:"暂无可用标签"})})]})})]})]})})]})]})]})}var w=r(3145);let v=e=>{let t=e.startsWith("/")?e.substring(1):e;return"".concat(window.location.origin,"/").concat(t)},j=e=>e<1024?e+" B":e<1048576?(e/1024).toFixed(2)+" KB":e<1073741824?(e/1048576).toFixed(2)+" MB":(e/1073741824).toFixed(2)+" GB",k=e=>({png:"PNG",jpg:"JPG",jpeg:"JPEG",webp:"WebP",gif:"GIF"})[e.toLowerCase()]||e.toUpperCase(),N=e=>({landscape:"横向",portrait:"纵向",square:"方形"})[e.toLowerCase()]||e;function C(e){let{image:t,onClick:r}=e,[i,l]=(0,s.useState)("idle"),[o,n]=(0,s.useState)(!1),[d,u]=(0,s.useState)(!0),[g,m]=(0,s.useState)(null),x="gif"===t.format.toLowerCase();(0,s.useEffect)(()=>{let e=async()=>{try{let e=await fetch(t.url),r=await e.blob(),a=new FileReader;a.onloadend=()=>{m(a.result)},a.readAsDataURL(r)}catch(e){console.error("Error generating blur placeholder:",e)}};x||e()},[t.url,x]);let h=(0,s.useCallback)(()=>{u(!1)},[]),{heightClass:p,aspectRatio:f}=(e=>{switch(e.toLowerCase()){case"portrait":return{heightClass:"h-auto",aspectRatio:"aspect-[3/4]"};case"landscape":return{heightClass:"h-auto",aspectRatio:"aspect-[4/3]"};case"square":return{heightClass:"h-auto",aspectRatio:"aspect-square"};default:return{heightClass:"h-auto",aspectRatio:"aspect-auto"}}})(t.orientation),b=async e=>{e.stopPropagation();try{let e=v(t.url);await navigator.clipboard.writeText(e),l("copied"),setTimeout(()=>l("idle"),2e3)}catch(e){console.error("复制失败:",e),l("error"),setTimeout(()=>l("idle"),2e3)}};return(0,a.jsxs)(c.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},whileHover:{y:-8,transition:{duration:.2}},className:"bg-white dark:bg-slate-800 rounded-xl shadow-lg overflow-hidden group cursor-pointer border border-gray-100 dark:border-gray-700 hover:border-indigo-300 dark:hover:border-indigo-500 transition-all duration-300 flex flex-col h-full",onClick:r,onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1),children:[(0,a.jsxs)("div",{className:"relative ".concat(p," ").concat(f," overflow-hidden bg-gray-100 dark:bg-gray-900"),children:[x?(0,a.jsx)("img",{src:t.url,alt:t.filename,loading:"lazy",onLoad:h,className:"w-full h-full object-cover transition-all duration-500 ".concat(d?"scale-110 blur-lg":"scale-100 blur-0 group-hover:scale-105")}):(0,a.jsx)(w.default,{src:t.url,alt:t.filename,fill:!0,loading:"lazy",onLoad:h,placeholder:g?"blur":"empty",blurDataURL:g||void 0,className:"object-cover w-full h-full transition-all duration-500 ".concat(d?"scale-110 blur-lg":"scale-100 blur-0 group-hover:scale-105"),sizes:"(max-width: 640px) 100vw, (max-width: 768px) 50vw, (max-width: 1024px) 33vw, 25vw",quality:75,priority:!1}),d&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 dark:bg-gray-900",children:(0,a.jsx)("div",{className:"w-8 h-8 border-2 border-indigo-500 border-t-transparent rounded-full animate-spin"})}),(0,a.jsxs)("div",{className:"absolute top-0 left-0 right-0 p-3 flex justify-between items-center bg-gradient-to-b from-black/60 to-transparent text-white transition-opacity duration-300 ".concat(d?"opacity-0":"opacity-100"),children:[(0,a.jsxs)("div",{className:"flex space-x-1",children:[(0,a.jsx)("span",{className:"text-xs font-medium px-2 py-1 rounded-full backdrop-blur-sm ".concat(x?"bg-green-500/70":"bg-blue-500/70"),children:k(t.format)}),(0,a.jsx)("span",{className:"text-xs font-medium px-2 py-1 rounded-full bg-purple-500/70 backdrop-blur-sm",children:N(t.orientation)})]}),(0,a.jsxs)(c.E.button,{initial:{opacity:0},animate:{opacity:o?1:0},onClick:b,className:"p-1.5 rounded-full bg-white/20 backdrop-blur-sm hover:bg-white/40 transition-colors",title:"复制URL",children:["idle"===i&&(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),"copied"===i&&(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-green-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}),"error"===i&&(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})]})]})]}),(0,a.jsxs)("div",{className:"p-4 flex-grow flex flex-col justify-between transition-opacity duration-300 ".concat(d?"opacity-50":"opacity-100"),children:[(0,a.jsx)("div",{className:"truncate text-sm font-medium text-gray-900 dark:text-white",children:t.filename}),(0,a.jsxs)("div",{className:"flex justify-between items-center mt-3",children:[(0,a.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:j(t.size)}),t.width&&t.height?(0,a.jsxs)(c.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},className:"text-xs font-medium px-2 py-1 rounded-full bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300",children:[t.width," x ",t.height]}):null]})]})]})}let L=e=>{let{image:t}=e;return"gif"===t.format.toLowerCase()?(0,a.jsxs)("div",{className:"h-full w-full flex items-center justify-center",children:[(0,a.jsx)("img",{src:t.url,alt:t.filename,className:"max-h-full max-w-full object-contain"}),(0,a.jsx)("a",{href:t.url,download:t.filename,className:"absolute bottom-4 right-4 bg-indigo-500 hover:bg-indigo-600 text-white p-2 rounded-full shadow-lg transition-colors duration-300",onClick:e=>e.stopPropagation(),title:"下载GIF",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})})]}):(0,a.jsx)(w.default,{src:t.url,alt:t.filename,fill:!0,className:"object-contain",sizes:"(max-width: 768px) 100vw, 50vw"})},E=e=>e<1024?e+" B":e<1048576?(e/1024).toFixed(2)+" KB":e<1073741824?(e/1048576).toFixed(2)+" MB":(e/1073741824).toFixed(2)+" GB",O=e=>({png:"PNG",jpg:"JPG",jpeg:"JPEG",webp:"WebP",gif:"GIF",avif:"AVIF"})[e.toLowerCase()]||e.toUpperCase(),S=e=>({landscape:"横向",portrait:"纵向",square:"方形"})[e.toLowerCase()]||e,M=(e,t)=>"![".concat(t,"](").concat(e,")"),P=e=>{let{image:t}=e;return(0,a.jsxs)("div",{className:"space-y-1 mt-2",children:[(0,a.jsxs)("div",{className:"flex flex-wrap gap-1 mb-2",children:[(0,a.jsx)("div",{className:"flex items-center px-3 py-1 rounded-full text-xs font-medium ".concat("gif"===t.format.toLowerCase()?"bg-green-50 dark:bg-green-900/20 text-green-600 dark:text-green-300":"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-300"),children:O(t.format)}),(0,a.jsx)("div",{className:"flex items-center bg-purple-50 dark:bg-purple-900/20 text-purple-600 dark:text-purple-300 px-3 py-1 rounded-full text-xs font-medium",children:S(t.orientation)}),(0,a.jsx)("div",{className:"flex items-center bg-green-50 dark:bg-green-900/20 text-green-600 dark:text-green-300 px-3 py-1 rounded-full text-xs font-medium",children:E(t.size)}),t.width&&t.height&&(0,a.jsxs)("div",{className:"flex items-center bg-amber-50 dark:bg-amber-900/20 text-amber-600 dark:text-amber-300 px-3 py-1 rounded-full text-xs font-medium",children:[t.width," x ",t.height]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"路径"}),(0,a.jsx)("div",{className:"font-mono text-xs bg-gray-50 dark:bg-gray-800 p-1 rounded text-gray-700 dark:text-gray-300 truncate",children:t.path})]})]})};var B=r(1214),F=r(3594);let A=e=>{var t,r,i;let{image:l}=e,[o,n]=(0,s.useState)(null),d=(e,t,r)=>{r&&r.stopPropagation(),(0,B.v)(e).then(e=>{e?(n({type:t}),setTimeout(()=>{n(null)},2e3)):console.error("复制失败")}).catch(e=>{console.error("复制失败:",e)})},c=(0,F.m)((null===(t=l.urls)||void 0===t?void 0:t.original)||""),u=(0,F.m)((null===(r=l.urls)||void 0===r?void 0:r.webp)||""),g=(0,F.m)((null===(i=l.urls)||void 0===i?void 0:i.avif)||""),m=M("webp"===l.format.toLowerCase()?u:"avif"===l.format.toLowerCase()?g:c,l.filename),x=e=>{let{type:t,text:r}=e;return(0,a.jsx)("button",{onClick:e=>d(r,t,e),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-r-lg transition-colors relative",title:"复制链接",children:o&&o.type===t?(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}):(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-500 dark:text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})},h=e=>{let{icon:t,label:r,url:s,type:i}=e;return(0,a.jsxs)("div",{className:"mb-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 mb-1",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 ".concat(t),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14"})}),(0,a.jsx)("div",{className:"text-xs font-medium",children:r})]}),(0,a.jsxs)("div",{className:"rounded-lg bg-gray-50 dark:bg-gray-800 flex items-center relative",children:[(0,a.jsx)("div",{className:"flex-1 px-2 py-1 text-xs font-mono overflow-hidden text-ellipsis",children:s}),(0,a.jsx)(x,{type:i,text:s})]})]})};return(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("div",{className:"mb-1",children:(0,a.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:"可用格式"})}),(0,a.jsx)(h,{icon:"text-blue-500",label:"gif"===l.format.toLowerCase()?"GIF 动图":"原始格式",url:c,type:"original"}),"gif"!==l.format.toLowerCase()&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h,{icon:"text-purple-500",label:"WebP格式",url:u,type:"webp"}),(0,a.jsx)(h,{icon:"text-green-500",label:"AVIF格式",url:g,type:"avif"})]}),(0,a.jsx)(h,{icon:"text-amber-500",label:"Markdown格式",url:m,type:"markdown"})]})},W=e=>{let{isDeleting:t,onCancel:r,onConfirm:s}=e;return(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-center text-xs text-red-600 dark:text-red-400",children:"确定要删除此图片吗？（将同时删除所有相关格式）"}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:r,className:"flex-1 py-1 px-3 rounded-lg border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors text-xs",disabled:t,children:"取消"}),(0,a.jsx)("button",{onClick:s,className:"flex-1 py-1 px-3 rounded-lg bg-red-500 hover:bg-red-600 text-white transition-colors text-xs flex items-center justify-center",disabled:t,children:t?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"处理中"]}):"确认删除"})]})]})};function I(e){let{image:t,isOpen:r,onClose:i,onDelete:l}=e,[o,n]=(0,s.useState)(!1),[d,u]=(0,s.useState)(!1);(0,s.useEffect)(()=>{r||(n(!1),u(!1))},[r]);let g=async()=>{if(t)try{u(!0),await l(t.id),n(!1),i()}catch(e){console.error("删除失败:",e)}finally{u(!1)}};return t?(0,a.jsx)(b.M,{children:r&&(0,a.jsx)(c.E.div,{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:i,children:(0,a.jsxs)(c.E.div,{className:"relative bg-white dark:bg-slate-900 rounded-xl overflow-hidden shadow-2xl max-w-4xl w-full flex flex-col",initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},transition:{type:"spring",damping:25,stiffness:300},onClick:e=>e.stopPropagation(),children:[(0,a.jsx)("button",{className:"absolute top-4 right-4 z-10 p-2 bg-black/20 dark:bg-white/10 rounded-full hover:bg-black/30 dark:hover:bg-white/20 transition-colors",onClick:i,children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,a.jsx)("div",{className:"border-b border-gray-100 dark:border-gray-800 px-6 py-4",children:(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white truncate",children:t.filename})}),(0,a.jsxs)("div",{className:"flex flex-col md:flex-row",children:[(0,a.jsx)("div",{className:"relative w-full md:w-1/2 bg-gray-100 dark:bg-gray-800 flex items-center justify-center p-4",children:(0,a.jsx)("div",{className:"relative w-full",style:{height:"380px"},children:(0,a.jsx)(L,{image:t})})}),(0,a.jsxs)("div",{className:"w-full md:w-1/2 p-4 flex flex-col h-full md:h-[380px]",children:[(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsx)(P,{image:t}),(0,a.jsx)(A,{image:t})]}),(0,a.jsx)("div",{className:"pt-1 border-t border-gray-100 dark:border-gray-800 mt-1",children:o?(0,a.jsx)(W,{isDeleting:d,onCancel:()=>n(!1),onConfirm:g}):(0,a.jsxs)("button",{onClick:()=>n(!0),className:"flex items-center justify-center w-full p-2 rounded-lg border border-red-200 dark:border-red-800 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"删除图片"]})})]})]})]})})}):null}var z=r(6973),R=r(3521);function V(){let{isDarkMode:e,toggleTheme:t}=(0,z.F)(),[r,i]=(0,s.useState)(!1),[u,g]=(0,s.useState)([]),[m,b]=(0,s.useState)(null),[w,v]=(0,s.useState)(!0),[j,k]=(0,s.useState)(null),[N,L]=(0,s.useState)(1),[E,O]=(0,s.useState)(1),[S,M]=(0,s.useState)(0),[P,B]=(0,s.useState)({format:"original",orientation:"all",tag:""}),[F,A]=(0,s.useState)(!1),[W,V]=(0,s.useState)(!1),[D,G]=(0,s.useState)(!0),[T,_]=(0,s.useState)(!1),{ref:q,inView:U}=function(){var e;let{threshold:t,delay:r,trackVisibility:a,rootMargin:i,root:c,triggerOnce:u,skip:g,initialInView:m,fallbackInView:x,onChange:h}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[p,f]=s.useState(null),b=s.useRef(h),[y,w]=s.useState({inView:!!m,entry:void 0});b.current=h,s.useEffect(()=>{let e;if(!g&&p)return e=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:d;if(void 0===window.IntersectionObserver&&void 0!==a){let s=e.getBoundingClientRect();return t(a,{isIntersecting:a,target:e,intersectionRatio:"number"==typeof r.threshold?r.threshold:0,time:0,boundingClientRect:s,intersectionRect:s,rootBounds:s}),()=>{}}let{id:s,observer:i,elements:c}=function(e){let t=Object.keys(e).sort().filter(t=>void 0!==e[t]).map(t=>{var r;return"".concat(t,"_").concat("root"===t?(r=e.root)?(o.has(r)||(n+=1,o.set(r,n.toString())),o.get(r)):"0":e[t])}).toString(),r=l.get(t);if(!r){let a;let s=new Map,i=new IntersectionObserver(t=>{t.forEach(t=>{var r;let i=t.isIntersecting&&a.some(e=>t.intersectionRatio>=e);e.trackVisibility&&void 0===t.isVisible&&(t.isVisible=i),null==(r=s.get(t.target))||r.forEach(e=>{e(i,t)})})},e);a=i.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),r={id:t,observer:i,elements:s},l.set(t,r)}return r}(r),u=c.get(e)||[];return c.has(e)||c.set(e,u),u.push(t),i.observe(e),function(){u.splice(u.indexOf(t),1),0===u.length&&(c.delete(e),i.unobserve(e)),0===c.size&&(i.disconnect(),l.delete(s))}}(p,(t,r)=>{w({inView:t,entry:r}),b.current&&b.current(t,r),r.isIntersecting&&u&&e&&(e(),e=void 0)},{root:c,rootMargin:i,threshold:t,trackVisibility:a,delay:r},x),()=>{e&&e()}},[Array.isArray(t)?t.toString():t,p,c,i,u,g,a,x,r]);let v=null==(e=y.entry)?void 0:e.target,j=s.useRef(void 0);p||!v||u||g||j.current===v||(j.current=v,w({inView:!!m,entry:void 0}));let k=[f,y.inView,y.entry];return k.ref=k[0],k.inView=k[1],k.entry=k[2],k}({threshold:.5,delay:100}),H=(0,s.useCallback)(e=>{e.forEach(e=>{new Image().src=e})},[]);(0,s.useEffect)(()=>{J()},[]),(0,s.useEffect)(()=>{U&&D&&!T&&K()},[U,D]);let K=async()=>{if(!T&&D){_(!0);try{let e=Math.floor(u.length/24)+1,t=await p.hi.get("/api/images",{page:e.toString(),limit:"24",format:P.format,orientation:P.orientation,tag:P.tag});if(0===t.images.length)G(!1);else{g(e=>[...e,...t.images]),O(t.totalPages),M(t.total);let e=t.images.map(e=>e.url);H(e)}}catch(e){console.error("加载更多图片失败:",e),k({type:"error",message:"加载更多图片失败"})}finally{_(!1)}}},J=async()=>{let e=(0,h.Pi)();if(!e){i(!0),V(!1);return}if(!await (0,h.Gw)(e)){i(!0),V(!1),k({type:"error",message:"API Key无效,请重新验证"});return}V(!0),Z()},Z=async()=>{try{v(!0),g([]),G(!0),L(1);let e=await p.hi.get("/api/images",{page:"1",limit:"24",format:P.format,orientation:P.orientation,tag:P.tag});if(g(e.images),O(e.totalPages),M(e.total),k(null),24===e.images.length){let t=e.images.map(e=>e.url);H(t)}else G(!1)}catch(e){console.error("加载图片列表失败:",e),k({type:"error",message:"加载图片列表失败"})}finally{v(!1)}},$=async e=>{try{let t=u.find(t=>t.id===e);if(!t)return;let r=await p.hi.post("/api/delete-image",{id:t.id});r.success?(g(u.filter(t=>t.id!==e)),k({type:"success",message:r.message})):k({type:"error",message:r.message})}catch(e){console.error("删除失败:",e),k({type:"error",message:"删除失败"})}};return(0,s.useEffect)(()=>{Z()},[P]),(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-6 py-8",children:[(0,a.jsx)(R.Z,{onApiKeyClick:()=>i(!0),title:"ImageFlow",isKeyVerified:W}),j&&(0,a.jsx)(c.E.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"mb-8 p-4 rounded-xl ".concat("success"===j.type?"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300 border border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-300 border border-red-200 dark:border-red-800"),children:j.message}),(0,a.jsx)(y,{onFilterChange:(e,t,r)=>{B({format:e,orientation:t,tag:r})}}),w?(0,a.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-500"})}):(0,a.jsx)(a.Fragment,{children:u.length>0?(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsx)("div",{className:"all"===P.orientation?"":"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:"all"===P.orientation?(0,a.jsx)(x,{breakpointCols:{default:4,1280:4,1024:3,768:2,640:1},className:"my-masonry-grid",columnClassName:"my-masonry-grid_column",children:u.map((e,t)=>(0,a.jsx)(c.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3,delay:t%24*.05},children:(0,a.jsx)(C,{image:e,onClick:()=>{b(e),A(!0)}})},e.id))}):u.map((e,t)=>(0,a.jsx)(c.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3,delay:t%24*.05},children:(0,a.jsx)(C,{image:e,onClick:()=>{b(e),A(!0)}})},e.id))}),D&&(0,a.jsx)("div",{ref:q,className:"flex justify-center items-center py-8",children:T?(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500"}):(0,a.jsx)("div",{className:"text-gray-400 dark:text-gray-500",children:"向下滚动加载更多"})}),(0,a.jsx)("div",{className:"flex items-center justify-between bg-white dark:bg-slate-800 p-4 rounded-xl shadow border border-gray-100 dark:border-gray-700",children:(0,a.jsxs)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["共 ",(0,a.jsx)("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:S})," 张图片"]})})]}):(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-64 bg-white dark:bg-slate-800 rounded-xl shadow-md p-8 text-gray-500 dark:text-gray-400 border border-gray-100 dark:border-gray-700",children:[(0,a.jsx)("svg",{className:"w-16 h-16 mb-4 text-gray-300 dark:text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,a.jsx)("p",{className:"text-lg font-medium",children:"暂无图片"}),(0,a.jsx)("p",{className:"mt-2 text-sm",children:"请上传图片或调整筛选条件"})]})}),(0,a.jsx)(I,{image:m,isOpen:F,onClose:()=>{b(null),A(!1)},onDelete:$}),(0,a.jsx)(f.Z,{isOpen:r,onClose:()=>i(!1),onSuccess:()=>{V(!0),Z()}})]})}}},function(e){e.O(0,[434,75,971,117,744],function(){return e(e.s=1237)}),_N_E=e.O()}]);