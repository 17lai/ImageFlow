(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[133],{4223:function(e,t,r){Promise.resolve().then(r.bind(r,2860))},1227:function(e,t,r){"use strict";r.d(t,{Z:function(){return l}});var a=r(3827),s=r(4090),n=r(5810);function l(e){let{isOpen:t,onClose:r,onSuccess:l}=e,[i,o]=(0,s.useState)(""),[d,c]=(0,s.useState)(!1),[x,m]=(0,s.useState)(""),u=async e=>{e.preventDefault(),c(!0),m("");try{await (0,n.Gw)(i)?l(i):m("API Key无效,请重试")}catch(e){m("验证失败,请重试")}finally{c(!1)}};return t?(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4 text-gray-900 dark:text-white",children:"请输入API Key"}),(0,a.jsxs)("form",{onSubmit:u,children:[(0,a.jsx)("input",{type:"password",value:i,onChange:e=>o(e.target.value),className:"w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:"输入您的API Key",required:!0}),x&&(0,a.jsx)("p",{className:"text-red-500 mb-4",children:x}),(0,a.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,a.jsx)("button",{type:"button",onClick:r,className:"px-4 py-2 text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-white",children:"取消"}),(0,a.jsx)("button",{type:"submit",disabled:d,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50",children:d?"验证中...":"验证"})]})]})]})}):null}},2860:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return f}});var a=r(3827),s=r(4090),n=r(8792),l=r(5810),i=r(3914),o=r(1227);function d(e){let{onFilterChange:t}=e;return(0,a.jsxs)("div",{className:"flex gap-4 mb-6",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"格式"}),(0,a.jsxs)("select",{className:"w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100",onChange:e=>{let r=e.target.value,a=document.getElementById("orientation-filter");"gif"===r?(a.value="all",a.disabled=!0,a.classList.add("opacity-50","cursor-not-allowed")):(a.disabled=!1,a.classList.remove("opacity-50","cursor-not-allowed")),t(r,a.value)},children:[(0,a.jsx)("option",{value:"all",children:"所有格式"}),(0,a.jsx)("option",{value:"original",children:"原始格式"}),(0,a.jsx)("option",{value:"webp",children:"WebP"}),(0,a.jsx)("option",{value:"avif",children:"AVIF"}),(0,a.jsx)("option",{value:"gif",children:"GIF"})]})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"方向"}),(0,a.jsxs)("select",{id:"orientation-filter",className:"w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100",onChange:e=>{t(document.querySelector("select").value,e.target.value)},children:[(0,a.jsx)("option",{value:"all",children:"所有方向"}),(0,a.jsx)("option",{value:"landscape",children:"横向"}),(0,a.jsx)("option",{value:"portrait",children:"纵向"})]})]})]})}var c=r(703);function x(e){switch(e){case"original":return"原始格式";case"webp":return"WebP";case"avif":return"AVIF";default:return e.toUpperCase()}}function m(e){switch(e){case"landscape":return"横向";case"portrait":return"纵向";default:return e}}function u(e){if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]}function h(e){let{image:t,onClick:r}=e,s="portrait"===t.orientation?"aspect-[3/4]":"aspect-video";return(0,a.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-xl overflow-hidden shadow-md hover:shadow-lg transition-all transform hover:-translate-y-1 cursor-pointer",onClick:r,children:[(0,a.jsxs)("div",{className:"relative ".concat(s," bg-gray-200 dark:bg-gray-600 overflow-hidden flex items-center justify-center"),children:[(0,a.jsx)(c.default,{src:t.url,alt:t.filename,fill:!0,className:"object-cover"}),(0,a.jsxs)("div",{className:"absolute top-2 right-2 flex gap-1",children:[(0,a.jsx)("span",{className:"px-2 py-1 bg-indigo-500 bg-opacity-80 text-white text-xs rounded-md",children:x(t.format)}),(0,a.jsx)("span",{className:"px-2 py-1 bg-purple-500 bg-opacity-80 text-white text-xs rounded-md",children:m(t.orientation)})]})]}),(0,a.jsxs)("div",{className:"p-3",children:[(0,a.jsx)("div",{className:"truncate text-gray-800 dark:text-gray-200 font-medium",children:t.filename}),(0,a.jsx)("div",{className:"text-gray-500 dark:text-gray-400 text-sm",children:u(t.size)})]})]})}function g(e){let{image:t,isOpen:r,onClose:n,onDelete:l}=e,[i,o]=(0,s.useState)(!1),[d,h]=(0,s.useState)("idle");if(!r||!t)return null;let g=async()=>{if(confirm("确定要删除图片 ".concat(t.filename," 吗？这将删除该图片的所有格式（原始、WebP和AVIF）。"))){o(!0);try{await l(t.id),n()}catch(e){console.error("删除失败:",e)}finally{o(!1)}}},y=async e=>{try{await navigator.clipboard.writeText(e),h("success"),setTimeout(()=>h("idle"),1500)}catch(e){console.error("复制失败:",e),h("error"),setTimeout(()=>h("idle"),1500)}},f=t.url.startsWith("http")?t.url:"".concat(window.location.protocol,"//").concat(window.location.host).concat(t.url);return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl max-w-4xl w-full max-h-[90vh] overflow-hidden shadow-xl",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between",children:[(0,a.jsxs)("h3",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100",children:["图片详情 - ",t.filename]}),(0,a.jsx)("button",{onClick:n,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsxs)("div",{className:"flex flex-col md:flex-row",children:[(0,a.jsx)("div",{className:"md:w-2/3 relative aspect-video",children:(0,a.jsx)(c.default,{src:t.url,alt:t.filename,fill:!0,className:"object-contain"})}),(0,a.jsxs)("div",{className:"md:w-1/3 p-4 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"文件名"}),(0,a.jsx)("p",{className:"text-gray-900 dark:text-gray-100",children:t.filename})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"路径"}),(0,a.jsx)("p",{className:"text-gray-900 dark:text-gray-100 break-all",children:t.path})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"大小"}),(0,a.jsx)("p",{className:"text-gray-900 dark:text-gray-100",children:u(t.size)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"格式"}),(0,a.jsx)("p",{className:"text-gray-900 dark:text-gray-100",children:x(t.format)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"方向"}),(0,a.jsx)("p",{className:"text-gray-900 dark:text-gray-100",children:m(t.orientation)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"URL"}),(0,a.jsxs)("div",{className:"mt-1 flex",children:[(0,a.jsx)("input",{type:"text",readOnly:!0,value:f,className:"flex-1 rounded-l-lg border border-r-0 border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-gray-100 text-sm"}),(0,a.jsxs)("button",{onClick:()=>y(f),className:"px-3 rounded-r-lg border border-l-0 border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-600",children:["idle"===d&&(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"})}),"success"===d&&(0,a.jsx)("svg",{className:"w-5 h-5 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"error"===d&&(0,a.jsx)("svg",{className:"w-5 h-5 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]})]}),(0,a.jsx)("button",{onClick:g,disabled:i,className:"w-full mt-4 flex items-center justify-center px-4 py-2 border border-transparent rounded-md shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed",children:i?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-5 w-5 text-white",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"正在删除..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"删除图片"]})})]})]})]})})}function y(e){let{currentPage:t,totalPages:r,onPageChange:s}=e;return r<=1?null:(0,a.jsxs)("div",{className:"flex items-center justify-between mt-6",children:[(0,a.jsxs)("button",{onClick:()=>s(t-1),disabled:t<=1,className:"flex items-center px-4 py-2 text-sm font-medium rounded-md ".concat(t<=1?"text-gray-400 dark:text-gray-500 cursor-not-allowed":"text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[(0,a.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"上一页"]}),(0,a.jsxs)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:["第 ",t," 页，共 ",r," 页"]}),(0,a.jsxs)("button",{onClick:()=>s(t+1),disabled:t>=r,className:"flex items-center px-4 py-2 text-sm font-medium rounded-md ".concat(t>=r?"text-gray-400 dark:text-gray-500 cursor-not-allowed":"text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700"),children:["下一页",(0,a.jsx)("svg",{className:"w-5 h-5 ml-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]})}function f(){let[e,t]=(0,s.useState)(!0),[r,c]=(0,s.useState)(!1),[x,m]=(0,s.useState)([]),[u,f]=(0,s.useState)(null),[p,j]=(0,s.useState)(!0),[b,v]=(0,s.useState)(null),[k,w]=(0,s.useState)(1),[N,L]=(0,s.useState)(1),[C,M]=(0,s.useState)(0),[S,P]=(0,s.useState)({format:"all",orientation:"all"});(0,s.useEffect)(()=>{let e=localStorage.getItem("theme");e&&(t("dark"===e),"dark"===e?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")),(async()=>{let e=(0,l.Pi)();if(!e){c(!0);return}if(!await (0,l.Gw)(e)){c(!0),v({type:"error",message:"API Key无效,请重新验证"});return}B()})()},[]);let B=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k;try{j(!0);let t=await i.hi.get("/api/images",{page:e.toString(),limit:"12",format:S.format,orientation:S.orientation});m(t.images),w(t.page),L(t.totalPages),M(t.total),v(null)}catch(e){console.error("加载图片列表失败:",e),v({type:"error",message:"加载图片列表失败"})}finally{j(!1)}},E=async e=>{try{let t=x.find(t=>t.id===e);if(!t)return;let r=await i.hi.post("/api/delete-image",{id:t.id,storageType:t.storageType});r.success?(m(x.filter(t=>t.id!==e)),v({type:"success",message:r.message})):v({type:"error",message:r.message})}catch(e){console.error("删除失败:",e),v({type:"error",message:"删除失败"})}};return(0,a.jsxs)("div",{className:"max-w-6xl mx-auto px-6 py-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-10",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(n.default,{href:"/",className:"mr-4",children:(0,a.jsx)("div",{className:"bg-gradient-primary w-14 h-14 rounded-2xl flex items-center justify-center shadow-lg transform rotate-12",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})})}),(0,a.jsx)("h1",{className:"text-4xl font-bold bg-clip-text text-transparent bg-gradient-primary",children:"图片管理"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("button",{onClick:()=>c(!0),className:"btn-icon",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"})})}),(0,a.jsx)("button",{onClick:()=>{let r=!e;t(r),localStorage.setItem("theme",r?"dark":"light"),r?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},className:"btn-icon",children:e?(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-amber-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})}):(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-gray-700 dark:text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})})})]})]}),b&&(0,a.jsx)("div",{className:"mb-8 p-4 rounded-xl ".concat("success"===b.type?"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300":"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-300"),children:b.message}),(0,a.jsx)(d,{onFilterChange:(e,t)=>{P({format:e,orientation:t}),w(1),B(1)}}),p?(0,a.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-500"})}):(0,a.jsx)(a.Fragment,{children:x.length>0?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:x.map(e=>(0,a.jsx)(h,{image:e,onClick:()=>f(e)},e.id))}),(0,a.jsxs)("div",{className:"mt-6 flex items-center justify-between",children:[(0,a.jsxs)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["共 ",C," 张图片"]}),(0,a.jsx)(y,{currentPage:k,totalPages:N,onPageChange:e=>{w(e),B(e)}})]})]}):(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500 dark:text-gray-400",children:[(0,a.jsx)("svg",{className:"w-16 h-16 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,a.jsx)("p",{children:"暂无图片"})]})}),(0,a.jsx)(g,{image:u,isOpen:!!u,onClose:()=>f(null),onDelete:E}),(0,a.jsx)(o.Z,{isOpen:r,onClose:()=>c(!1),onSuccess:e=>{(0,l.Lb)(e),c(!1),v({type:"success",message:"API Key验证成功！"}),B()}})]})}},5810:function(e,t,r){"use strict";r.d(t,{Gw:function(){return l},Lb:function(){return n},Pi:function(){return s}});let a="imageflow_api_key",s=()=>localStorage.getItem(a),n=e=>{localStorage.setItem(a,e)},l=async e=>{try{let t=await fetch("/validate-api-key",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}),r=await t.json();return!0===r.valid}catch(e){return console.error("API Key validation error:",e),!1}}},3914:function(e,t,r){"use strict";r.d(t,{hi:function(){return n}});var a=r(5810);async function s(e){let t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=(0,a.Pi)();if(!s)throw Error("未设置API Key");let{params:n,...l}=r;try{t=new URL(e,window.location.origin)}catch(r){t=new URL(e,window.location.origin)}n&&Object.entries(n).forEach(e=>{let[r,a]=e;t.searchParams.append(r,a)});let i={Authorization:"Bearer ".concat(s),...r.headers},o=await fetch(t.toString(),{...l,headers:i});if(!o.ok)throw Error((await o.json().catch(()=>({}))).message||"请求失败");return o.json()}let n={get:(e,t)=>s(e,{method:"GET",params:t}),post:(e,t)=>s(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),delete:e=>s(e,{method:"DELETE"}),upload:(e,t)=>{let r=new FormData;return t.forEach(e=>{r.append("images[]",e)}),s(e,{method:"POST",body:r})}}}},function(e){e.O(0,[607,971,69,744],function(){return e(e.s=4223)}),_N_E=e.O()}]);