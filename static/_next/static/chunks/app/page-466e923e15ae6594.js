(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{5140:function(e,t,r){Promise.resolve().then(r.bind(r,7686))},7686:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return N}});var s=r(7437),a=r(2265),o=r(5017),l=r(6329),i=r(2896),n=r(3521);function d(e){let{onFilesSelected:t,maxUploadCount:r}=e,o=(0,a.useRef)(null);return(0,s.jsxs)("div",{className:"drop-zone mb-6 flex flex-col items-center justify-center cursor-pointer",onDrop:e=>{e.preventDefault(),t(Array.from(e.dataTransfer.files))},onDragOver:e=>{e.preventDefault(),e.currentTarget.classList.add("active")},onDragLeave:e=>{e.preventDefault(),e.currentTarget.classList.remove("active")},children:[(0,s.jsx)("div",{className:"mb-4 bg-indigo-100 dark:bg-indigo-900/50 p-4 rounded-full",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-indigo-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})}),(0,s.jsx)("p",{className:"text-lg font-medium mb-2",children:"拖放多张图片到这里"}),(0,s.jsx)("p",{className:"text-sm text-light-text-secondary dark:text-dark-text-secondary mb-4",children:"或者点击选择文件（可多选）"}),(0,s.jsxs)("p",{className:"text-sm text-light-text-secondary dark:text-dark-text-secondary mb-4",children:["最多可选择 ",r," 张图片"]}),(0,s.jsx)("input",{type:"file",ref:o,className:"hidden",accept:"image/*",multiple:!0,onChange:e=>{let r=e.target.files;r&&t(Array.from(r))}}),(0,s.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=o.current)||void 0===e?void 0:e.click()},className:"btn-primary px-4 py-2",children:"选择图片"})]})}function c(e){let{onChange:t}=e,[r,o]=(0,a.useState)("never"),[l,i]=(0,a.useState)(1),[n,d]=(0,a.useState)("hours");(0,a.useEffect)(()=>{t(0)},[t]);let c=e=>{o(e);let r=0;switch(e){case"never":r=0;break;case"1h":r=60;break;case"24h":r=1440;break;case"7d":r=10080;break;case"30d":r=43200;break;case"custom":r="minutes"===n?l:60*l}t(r)},x=e=>{d(e),"custom"===r&&t("minutes"===e?l:60*l)};return(0,s.jsxs)("div",{className:"mb-6 bg-gradient-to-br from-white to-gray-50 dark:from-slate-800 dark:to-slate-900 rounded-xl p-6 shadow-md border border-gray-100 dark:border-gray-700",children:[(0,s.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,s.jsxs)("h3",{className:"text-lg font-medium flex items-center text-gray-800 dark:text-gray-200",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2 text-indigo-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"图片过期时间"]})}),(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"设置图片的自动过期时间，过期后图片将被自动删除。"}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-3 mb-4",children:[(0,s.jsxs)("button",{type:"button",onClick:()=>c("never"),className:"relative px-3 py-3 text-sm font-medium rounded-xl shadow-sm transition-all duration-200 overflow-hidden ".concat("never"===r?"bg-gradient-to-r from-indigo-500 to-purple-500 text-white border-transparent":"bg-white dark:bg-slate-800 hover:bg-gray-50 dark:hover:bg-slate-700 border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300"," border"),children:[(0,s.jsxs)("div",{className:"relative z-10 flex flex-col items-center justify-center h-full",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"})}),"永不过期"]}),"never"===r&&(0,s.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-indigo-500 to-purple-500 opacity-20 dark:opacity-40"})]}),(0,s.jsxs)("button",{type:"button",onClick:()=>c("1h"),className:"relative px-3 py-3 text-sm font-medium rounded-xl shadow-sm transition-all duration-200 overflow-hidden ".concat("1h"===r?"bg-gradient-to-r from-indigo-500 to-purple-500 text-white border-transparent":"bg-white dark:bg-slate-800 hover:bg-gray-50 dark:hover:bg-slate-700 border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300"," border"),children:[(0,s.jsxs)("div",{className:"relative z-10 flex flex-col items-center justify-center h-full",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"1小时"]}),"1h"===r&&(0,s.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-indigo-500 to-purple-500 opacity-20 dark:opacity-40"})]}),(0,s.jsxs)("button",{type:"button",onClick:()=>c("24h"),className:"relative px-3 py-3 text-sm font-medium rounded-xl shadow-sm transition-all duration-200 overflow-hidden ".concat("24h"===r?"bg-gradient-to-r from-indigo-500 to-purple-500 text-white border-transparent":"bg-white dark:bg-slate-800 hover:bg-gray-50 dark:hover:bg-slate-700 border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300"," border"),children:[(0,s.jsxs)("div",{className:"relative z-10 flex flex-col items-center justify-center h-full",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"1天"]}),"24h"===r&&(0,s.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-indigo-500 to-purple-500 opacity-20 dark:opacity-40"})]}),(0,s.jsxs)("button",{type:"button",onClick:()=>c("7d"),className:"relative px-3 py-3 text-sm font-medium rounded-xl shadow-sm transition-all duration-200 overflow-hidden ".concat("7d"===r?"bg-gradient-to-r from-indigo-500 to-purple-500 text-white border-transparent":"bg-white dark:bg-slate-800 hover:bg-gray-50 dark:hover:bg-slate-700 border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300"," border"),children:[(0,s.jsxs)("div",{className:"relative z-10 flex flex-col items-center justify-center h-full",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"7天"]}),"7d"===r&&(0,s.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-indigo-500 to-purple-500 opacity-20 dark:opacity-40"})]}),(0,s.jsxs)("button",{type:"button",onClick:()=>c("30d"),className:"relative px-3 py-3 text-sm font-medium rounded-xl shadow-sm transition-all duration-200 overflow-hidden ".concat("30d"===r?"bg-gradient-to-r from-indigo-500 to-purple-500 text-white border-transparent":"bg-white dark:bg-slate-800 hover:bg-gray-50 dark:hover:bg-slate-700 border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300"," border"),children:[(0,s.jsxs)("div",{className:"relative z-10 flex flex-col items-center justify-center h-full",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),"30天"]}),"30d"===r&&(0,s.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-indigo-500 to-purple-500 opacity-20 dark:opacity-40"})]}),(0,s.jsxs)("button",{type:"button",onClick:()=>c("custom"),className:"relative px-3 py-3 text-sm font-medium rounded-xl shadow-sm transition-all duration-200 overflow-hidden ".concat("custom"===r?"bg-gradient-to-r from-indigo-500 to-purple-500 text-white border-transparent":"bg-white dark:bg-slate-800 hover:bg-gray-50 dark:hover:bg-slate-700 border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300"," border"),children:[(0,s.jsxs)("div",{className:"relative z-10 flex flex-col items-center justify-center h-full",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),"自定义"]}),"custom"===r&&(0,s.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-indigo-500 to-purple-500 opacity-20 dark:opacity-40"})]})]}),"custom"===r&&(0,s.jsxs)("div",{className:"mt-4 mb-4 bg-white dark:bg-slate-800 p-4 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:"请设置自定义过期时间："}),(0,s.jsxs)("div",{className:"flex items-center justify-center",children:[(0,s.jsx)("div",{className:"relative",children:(0,s.jsx)("input",{type:"number",min:"1",value:l,onChange:e=>{let s=parseInt(e.target.value);!isNaN(s)&&s>0&&(i(s),"custom"===r&&t("minutes"===n?s:60*s))},className:"w-24 px-3 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-slate-800 text-gray-700 dark:text-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-600 text-center font-medium text-lg shadow-sm","aria-label":"自定义时间值"})}),(0,s.jsxs)("div",{className:"flex border rounded-lg overflow-hidden shadow-sm ml-3",children:[(0,s.jsx)("button",{type:"button",onClick:()=>x("minutes"),className:"px-4 py-2.5 text-sm font-medium transition-colors duration-200 ".concat("minutes"===n?"bg-indigo-500 text-white border-r border-indigo-600":"bg-white dark:bg-slate-800 text-gray-700 dark:text-gray-300 border-r border-gray-300 dark:border-gray-600"),children:"分钟"}),(0,s.jsx)("button",{type:"button",onClick:()=>x("hours"),className:"px-4 py-2.5 text-sm font-medium transition-colors duration-200 ".concat("hours"===n?"bg-indigo-500 text-white":"bg-white dark:bg-slate-800 text-gray-700 dark:text-gray-300"),children:"小时"})]})]})]}),(0,s.jsx)("div",{className:"p-4 rounded-xl ".concat("never"===r?"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 border border-blue-100 dark:border-blue-800":"bg-gradient-to-r from-amber-50 to-orange-50 dark:from-amber-900/20 dark:to-orange-900/20 border border-amber-100 dark:border-amber-800"),children:(0,s.jsx)("div",{className:"flex items-start",children:"never"===r?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"bg-blue-100 dark:bg-blue-900/30 p-2 rounded-full mr-3",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-blue-500 dark:text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-blue-700 dark:text-blue-300 mb-1",children:"永久保存"}),(0,s.jsx)("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:"图片将永久保存在服务器上，不会自动删除。"})]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"bg-amber-100 dark:bg-amber-900/30 p-2 rounded-full mr-3",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-amber-500 dark:text-amber-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-amber-700 dark:text-amber-300 mb-1",children:"自动过期"}),(0,s.jsxs)("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:["图片将在上传后",(0,s.jsx)("strong",{className:"font-medium",children:"custom"===r?"minutes"===n?" ".concat(l," 分钟 "):" ".concat(l," 小时 "):"1h"===r?" 1 小时 ":"24h"===r?" 1 天 ":"7d"===r?" 7 天 ":" 30 天 "}),"后自动删除。"]})]})]})})})]})}var x=r(9597),m=r(8614);function h(e){let{selectedTags:t,availableTags:r,onTagsChange:o}=e,[l,i]=(0,a.useState)(""),[n,d]=(0,a.useState)(!1),[c,h]=(0,a.useState)(""),g=(0,a.useRef)(null),u=e=>{o(t.includes(e)?t.filter(t=>t!==e):[...t,e]),d(!1)},p=()=>{if(l.trim()){let e=l.trim();t.includes(e)||o([...t,e]),i(""),d(!1)}},b=""===c.trim()?r.filter(e=>!t.includes(e)):r.filter(e=>!t.includes(e)&&e.toLowerCase().includes(c.toLowerCase()));return(0,s.jsxs)("div",{className:"mb-6 bg-gradient-to-br from-white to-gray-50 dark:from-slate-800 dark:to-slate-900 rounded-xl p-6 shadow-md border border-gray-100 dark:border-gray-700",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsxs)("h3",{className:"text-lg font-medium flex items-center text-gray-800 dark:text-gray-200",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2 text-indigo-500",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M17.707 9.293a1 1 0 010 1.414l-7 7a1 1 0 01-1.414 0l-7-7A.997.997 0 012 10V5a3 3 0 013-3h5c.256 0 .512.098.707.293l7 7zM5 6a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})}),"添加标签"]}),(0,s.jsxs)("div",{className:"relative",ref:g,children:[(0,s.jsxs)(x.E.button,{type:"button",whileTap:{scale:.95},onClick:()=>{d(!n),h("")},className:"px-4 py-2 rounded-full text-sm font-medium bg-gradient-to-r from-indigo-500 to-purple-500 text-white hover:from-indigo-600 hover:to-purple-600 transition-all duration-200 flex items-center gap-1 shadow-sm",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v16m8-8H4"})}),"添加标签"]}),(0,s.jsx)(m.M,{children:n&&(0,s.jsxs)(x.E.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.95},transition:{duration:.15},className:"absolute right-0 top-full mt-2 w-72 bg-white dark:bg-gray-800 rounded-xl shadow-xl border border-gray-200 dark:border-gray-700 z-50 overflow-hidden",children:[(0,s.jsx)("div",{className:"p-3 bg-gradient-to-r from-indigo-500 to-purple-500 text-white",children:(0,s.jsx)("h4",{className:"font-medium",children:"选择或创建标签"})}),(0,s.jsx)("div",{className:"p-3 sticky top-0 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:"text",value:c,onChange:e=>{h(e.target.value)},onKeyDown:e=>{"Enter"===e.key&&e.preventDefault()},placeholder:"搜索标签...",className:"w-full px-3 py-2 pl-9 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-600 text-sm"}),(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]})}),(0,s.jsxs)("div",{className:"p-3 max-h-48 overflow-y-auto",children:[(0,s.jsx)("h5",{className:"text-xs uppercase tracking-wider text-gray-500 dark:text-gray-400 mb-2 font-medium",children:"可用标签"}),b.length>0?(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:b.map(e=>(0,s.jsx)(x.E.button,{type:"button",whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>u(e),className:"px-3 py-1.5 rounded-full text-sm font-medium transition-all duration-200 bg-gray-100 dark:bg-gray-700 hover:bg-indigo-100 dark:hover:bg-indigo-900/30 text-gray-700 dark:text-gray-300 hover:text-indigo-700 dark:hover:text-indigo-300 border border-transparent hover:border-indigo-200 dark:hover:border-indigo-800",children:e},e))}):c?(0,s.jsx)("div",{className:"py-3 text-center text-gray-500 dark:text-gray-400 text-sm",children:"未找到匹配的标签"}):0===r.length?(0,s.jsx)("div",{className:"py-3 text-center text-gray-500 dark:text-gray-400 text-sm",children:"暂无可用标签"}):(0,s.jsx)("div",{className:"py-3 text-center text-gray-500 dark:text-gray-400 text-sm",children:"所有标签已选择"})]}),(0,s.jsxs)("div",{className:"p-3 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/30",children:[(0,s.jsx)("h5",{className:"text-xs uppercase tracking-wider text-gray-500 dark:text-gray-400 mb-2 font-medium",children:"创建新标签"}),(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("input",{type:"text",value:l,onChange:e=>{i(e.target.value)},placeholder:"输入新标签名称",className:"flex-1 px-3 py-2 rounded-l-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-600 text-sm",onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),p())}}),(0,s.jsxs)("button",{type:"button",onClick:p,className:"px-4 py-2 rounded-r-lg bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 text-white font-medium transition-colors duration-200 text-sm flex items-center",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v16m8-8H4"})}),"添加"]})]})]})]})})]})]}),(0,s.jsxs)("div",{className:"bg-white dark:bg-slate-800/50 rounded-lg p-4 border border-gray-100 dark:border-gray-700",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"已选标签："}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:t.length>0?t.map(e=>(0,s.jsxs)(x.E.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"bg-gradient-to-r from-indigo-500 to-purple-500 text-white px-3 py-1.5 rounded-full text-sm font-medium flex items-center shadow-sm",children:[(0,s.jsx)("span",{children:e}),(0,s.jsx)("button",{type:"button",onClick:()=>u(e),className:"ml-1.5 rounded-full p-0.5 hover:bg-white/20 transition-colors",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]},e)):(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 italic",children:"暂未选择标签"})})]})]})}var g=r(3145);function u(e){let{previews:t,onRemoveFile:r,onRemoveAll:a}=e;return(0,s.jsxs)("div",{className:"mb-6 bg-gradient-to-br from-white to-gray-50 dark:from-slate-800 dark:to-slate-900 rounded-xl p-6 shadow-md border border-gray-100 dark:border-gray-700",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsxs)("h3",{className:"text-lg font-medium flex items-center text-gray-800 dark:text-gray-200",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2 text-indigo-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14"})}),"已选择 ",(0,s.jsx)("span",{className:"text-indigo-600 dark:text-indigo-400",children:t.length})," 张图片"]}),(0,s.jsxs)("button",{type:"button",onClick:a,className:"px-3 py-1.5 text-sm bg-red-50 hover:bg-red-100 dark:bg-red-900/20 dark:hover:bg-red-900/30 text-red-600 dark:text-red-400 rounded-lg transition-colors duration-200 flex items-center",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"清除全部"]})]}),(0,s.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:t.map(e=>(0,s.jsxs)("div",{className:"relative group rounded-xl overflow-hidden bg-white dark:bg-slate-800 border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md transition-all duration-200",children:[e.url?(0,s.jsxs)("div",{className:"aspect-square relative",children:[(0,s.jsx)(g.default,{src:e.url,alt:e.file.name,fill:!0,className:"object-cover"}),(0,s.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/40 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-all duration-200"}),(0,s.jsx)("button",{type:"button",onClick:()=>r(e.id),className:"absolute bottom-2 right-2 bg-white/90 dark:bg-gray-800/90 rounded-full p-1.5 opacity-0 group-hover:opacity-100 transition-all duration-200 hover:bg-red-50 dark:hover:bg-red-900/20 hover:text-red-500 dark:hover:text-red-400",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}):(0,s.jsx)("div",{className:"aspect-square flex items-center justify-center bg-gray-100 dark:bg-gray-800",children:(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14"}),(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 5a2 2 0 10-4 0 2 2 0 004 0z"})]})}),(0,s.jsx)("div",{className:"p-3 text-xs truncate border-t border-gray-100 dark:border-gray-700 bg-white dark:bg-slate-800",children:e.file.name})]},e.id))})]})}function p(e){let{onUpload:t,isUploading:r,maxUploadCount:o=10}=e,[i,n]=(0,a.useState)([]),[x,m]=(0,a.useState)([]),[g,p]=(0,a.useState)(!1),[b,v]=(0,a.useState)(!1),[w,f]=(0,a.useState)(0),[k,j]=(0,a.useState)([]),[y,N]=(0,a.useState)([]);(0,a.useEffect)(()=>{(async()=>{try{let e=await l.hi.get("/api/tags");e.tags&&e.tags.length>0&&N(e.tags)}catch(e){console.error("获取标签失败:",e)}})()},[]),(0,a.useEffect)(()=>{g&&!r&&(n([]),m([]),v(!1)),p(r)},[r,g]);let L=e=>{let t=e.map(e=>({id:Math.random().toString(36).substring(2,11),url:"",file:e}));t.forEach((t,r)=>{let s=new FileReader;s.onload=e=>{m(r=>{let s=[...r],a=s.findIndex(e=>e.id===t.id);if(-1!==a){var o;s[a]={...s[a],url:null===(o=e.target)||void 0===o?void 0:o.result}}return s})},s.readAsDataURL(e[r])}),m(t)},C=async e=>{e.preventDefault(),0!==i.length&&await t(i,w,k)};return(0,s.jsxs)("div",{className:"card p-8 mb-8",children:[(0,s.jsxs)("h2",{className:"text-2xl font-semibold mb-6 flex items-center",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 mr-2 text-indigo-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"上传图片"]}),(0,s.jsxs)("form",{onSubmit:C,children:[(0,s.jsx)(d,{onFilesSelected:e=>{if(e.length>o){let t=e.slice(0,o);n(t),v(!0),L(t)}else n(e),v(!1),L(e)},maxUploadCount:o}),(0,s.jsx)(c,{onChange:f}),(0,s.jsx)(h,{selectedTags:k,availableTags:y,onTagsChange:j}),b&&(0,s.jsx)("div",{className:"mb-6 p-4 rounded-xl bg-gradient-to-r from-amber-50 to-yellow-50 dark:from-amber-900/20 dark:to-yellow-900/20 border border-amber-200 dark:border-amber-800 shadow-sm",children:(0,s.jsxs)("div",{className:"flex items-start",children:[(0,s.jsx)("div",{className:"bg-amber-100 dark:bg-amber-900/30 p-2 rounded-full mr-3 flex-shrink-0",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-amber-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-amber-700 dark:text-amber-300 mb-1",children:"超出上传限制"}),(0,s.jsxs)("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:["一次最多只能上传 ",(0,s.jsx)("span",{className:"font-medium",children:o})," 张图片。已自动选择前 ",o," 张。"]})]})]})}),x.length>0&&(0,s.jsx)(u,{previews:x,onRemoveFile:e=>{let t=x.filter(t=>t.id!==e);m(t);let r=i.filter(e=>t.some(t=>t.file===e));n(r),v(r.length>=o)},onRemoveAll:()=>{n([]),m([]),v(!1)}}),i.length>0&&(0,s.jsx)("button",{type:"submit",disabled:r,className:"w-full py-4 bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 text-white rounded-xl shadow-md transition-all duration-200 font-medium text-lg flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed",children:r?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"正在上传..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"开始上传"]})})]})]})}function b(e){let{type:t,message:r}=e;return(0,s.jsx)(x.E.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"mb-8 p-4 rounded-xl ".concat("success"===t?"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300":"warning"===t?"bg-yellow-50 dark:bg-yellow-900/20 text-yellow-700 dark:text-yellow-300":"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-300"),children:r})}function v(e){let{progress:t}=e;return(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"bg-light-bg-primary dark:bg-dark-bg-primary rounded-xl overflow-hidden mb-4",children:(0,s.jsx)("div",{className:"h-2 bg-gradient-primary transition-all duration-300",style:{width:"".concat(t,"%")}})}),(0,s.jsxs)("p",{className:"text-sm text-light-text-secondary dark:text-dark-text-secondary text-center",children:["上传进度: ",Math.round(t),"%"]})]})}var w=r(3594),f=r(1214);function k(e){let{isOpen:t,onClose:r,image:o,onDelete:l}=e,[i,n]=(0,a.useState)(null),[d,c]=(0,a.useState)(!1),[h,u]=(0,a.useState)(!1);if(!o||"success"!==o.status||!o.urls)return null;let p=(e,t,r)=>{r&&r.stopPropagation(),(0,f.v)(e).then(e=>{e?(n({type:t}),setTimeout(()=>{n(null)},2e3)):console.error("复制失败")}).catch(e=>{console.error("复制失败:",e)})},b=e=>e?(0,w.m)(e):"",v=b(o.urls.original),k=b(o.urls.webp),j=b(o.urls.avif),y=async()=>{if(o&&l)try{var e;u(!0);let t=o.id;if(!t&&(null===(e=o.urls)||void 0===e?void 0:e.original)){let e=o.urls.original.split("/");t=e[e.length-1].split(".")[0]}if(!t)throw Error("无法获取图像ID");await l(t),r()}catch(e){console.error("删除失败:",e)}finally{u(!1)}};return(0,s.jsx)(m.M,{children:t&&(0,s.jsx)(x.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:r,children:(0,s.jsxs)(x.E.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},transition:{type:"spring",damping:25,stiffness:300},className:"bg-white dark:bg-slate-800 rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"flex justify-between items-center p-4 border-b border-slate-200 dark:border-slate-700",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold",children:o.filename}),(0,s.jsx)("button",{onClick:r,className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-full transition-colors",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),(0,s.jsx)("div",{className:"overflow-y-auto max-h-[calc(90vh-5rem)]",children:(0,s.jsxs)("div",{className:"flex flex-col md:flex-row",children:[(0,s.jsx)("div",{className:"w-full md:w-2/5 p-4 md:border-r border-slate-200 dark:border-slate-700 flex items-center",children:(0,s.jsx)(x.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.1},className:"relative w-full h-full overflow-hidden rounded-lg border border-slate-200 dark:border-slate-700",style:{height:"400px"},children:(0,s.jsx)(g.default,{src:v,alt:o.filename,fill:!0,sizes:"(max-width: 768px) 100vw, 400px",className:"object-contain"})})}),(0,s.jsxs)("div",{className:"flex-1 p-4",children:[(0,s.jsx)("h4",{className:"text-lg font-medium mb-4",children:"图片信息"}),(0,s.jsxs)("div",{className:"mb-6 space-y-2",children:[o.format&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-sm font-medium",children:"原始格式:"}),(0,s.jsx)("span",{className:"text-sm bg-slate-100 dark:bg-slate-700 px-2 py-0.5 rounded",children:o.format.toUpperCase()})]}),o.orientation&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-sm font-medium",children:"图片方向:"}),(0,s.jsx)("span",{className:"text-sm bg-slate-100 dark:bg-slate-700 px-2 py-0.5 rounded capitalize",children:o.orientation})]}),o.expiryTime&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-sm font-medium",children:"过期时间:"}),(0,s.jsx)("span",{className:"text-sm bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-200 px-2 py-0.5 rounded",children:new Date(o.expiryTime).toLocaleString()})]})]}),(0,s.jsx)("h4",{className:"text-lg font-medium mb-4",children:"可用格式"}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)(x.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14"})}),(0,s.jsx)("div",{className:"font-medium",children:"原始图片"})]}),(0,s.jsxs)("div",{className:"rounded-lg bg-slate-100 dark:bg-slate-900 flex items-center group relative hover:bg-slate-200 dark:hover:bg-slate-800/80 transition-colors duration-200",children:[(0,s.jsx)("div",{className:"flex-1 px-4 py-3 text-sm font-mono overflow-hidden text-ellipsis",children:v}),(0,s.jsxs)("button",{onClick:e=>p(v,"original",e),className:"p-3 hover:bg-slate-200 dark:hover:bg-slate-800 rounded-r-lg transition-colors duration-200 relative",title:"复制链接",children:[i&&"original"===i.type?(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}):(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),i&&"original"===i.type&&(0,s.jsx)("span",{className:"absolute -top-8 right-0 bg-black/70 text-white text-xs rounded px-2 py-1",children:"已复制!"})]})]})]}),k&&(0,s.jsxs)(x.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3},children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-purple-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,s.jsx)("div",{className:"font-medium",children:"WebP 格式"})]}),(0,s.jsxs)("div",{className:"rounded-lg bg-slate-100 dark:bg-slate-900 flex items-center group relative hover:bg-slate-200 dark:hover:bg-slate-800/80 transition-colors duration-200",children:[(0,s.jsx)("div",{className:"flex-1 px-4 py-3 text-sm font-mono overflow-hidden text-ellipsis",children:k}),(0,s.jsxs)("button",{onClick:e=>p(k,"webp",e),className:"p-3 hover:bg-slate-200 dark:hover:bg-slate-800 rounded-r-lg transition-colors duration-200 relative",title:"复制链接",children:[i&&"webp"===i.type?(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}):(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),i&&"webp"===i.type&&(0,s.jsx)("span",{className:"absolute -top-8 right-0 bg-black/70 text-white text-xs rounded px-2 py-1",children:"已复制!"})]})]})]}),j&&(0,s.jsxs)(x.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.4},children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,s.jsx)("div",{className:"font-medium",children:"AVIF 格式"})]}),(0,s.jsxs)("div",{className:"rounded-lg bg-slate-100 dark:bg-slate-900 flex items-center group relative hover:bg-slate-200 dark:hover:bg-slate-800/80 transition-colors duration-200",children:[(0,s.jsx)("div",{className:"flex-1 px-4 py-3 text-sm font-mono overflow-hidden text-ellipsis",children:j}),(0,s.jsxs)("button",{onClick:e=>p(j,"avif",e),className:"p-3 hover:bg-slate-200 dark:hover:bg-slate-800 rounded-r-lg transition-colors duration-200 relative",title:"复制链接",children:[i&&"avif"===i.type?(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}):(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),i&&"avif"===i.type&&(0,s.jsx)("span",{className:"absolute -top-8 right-0 bg-black/70 text-white text-xs rounded px-2 py-1",children:"已复制!"})]})]})]}),(0,s.jsxs)(x.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.5},children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-amber-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"})}),(0,s.jsx)("div",{className:"font-medium",children:"Markdown 格式"})]}),(0,s.jsxs)("div",{className:"rounded-lg bg-slate-100 dark:bg-slate-900 flex items-center group relative hover:bg-slate-200 dark:hover:bg-slate-800/80 transition-colors duration-200",children:[(0,s.jsxs)("div",{className:"flex-1 px-4 py-3 text-sm font-mono overflow-hidden text-ellipsis",children:["![",o.filename,"](",v,")"]}),(0,s.jsxs)("button",{onClick:e=>p("![".concat(o.filename,"](").concat(v,")"),"markdown",e),className:"p-3 hover:bg-slate-200 dark:hover:bg-slate-800 rounded-r-lg transition-colors duration-200 relative",title:"复制链接",children:[i&&"markdown"===i.type?(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}):(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),i&&"markdown"===i.type&&(0,s.jsx)("span",{className:"absolute -top-8 right-0 bg-black/70 text-white text-xs rounded px-2 py-1",children:"已复制!"})]})]})]})]})]})]})}),(0,s.jsxs)(x.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.6},className:"p-4 border-t border-slate-200 dark:border-slate-700 flex justify-between",children:[l&&(0,s.jsx)("div",{children:d?(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)("button",{onClick:()=>c(!1),className:"px-3 py-2 border border-slate-200 dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors text-sm",disabled:h,children:"取消"}),(0,s.jsx)("button",{onClick:y,className:"px-3 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors text-sm flex items-center",disabled:h,children:h?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"处理中"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"确认删除"]})})]}):(0,s.jsxs)("button",{onClick:()=>c(!0),className:"px-4 py-2 text-red-600 dark:text-red-400 border border-red-200 dark:border-red-800 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors font-medium flex items-center",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"删除图片"]})}),(0,s.jsx)("button",{onClick:r,className:"px-4 py-2 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 rounded-lg transition-colors font-medium",children:"关闭"})]})]})})})}function j(e){let{isOpen:t,results:r,onClose:o,onDelete:l}=e,[i,n]=(0,a.useState)(null),[d,c]=(0,a.useState)(!1),[h,u]=(0,a.useState)("all"),p=r.filter(e=>"success"===e.status),b=r.filter(e=>"error"===e.status),v="all"===h?r:"success"===h?p:b,w=e=>{n(e),c(!0)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(m.M,{children:t&&(0,s.jsxs)(x.E.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"spring",damping:30,stiffness:300},className:"fixed top-0 right-0 w-full sm:w-96 h-full bg-white dark:bg-slate-900 shadow-xl z-30 border-l border-slate-200 dark:border-slate-700 overflow-hidden flex flex-col",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-700 bg-gradient-to-r from-indigo-500 to-purple-600 text-white",children:[(0,s.jsxs)("h2",{className:"text-lg font-semibold flex items-center",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2 text-white opacity-90",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z",clipRule:"evenodd"})}),"媒体库 (",r.length,")"]}),(0,s.jsx)("button",{onClick:o,className:"p-2 rounded-full hover:bg-white/10 transition-colors",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),(0,s.jsxs)("div",{className:"flex border-b border-slate-200 dark:border-slate-700",children:[(0,s.jsxs)("button",{onClick:()=>u("all"),className:"flex-1 py-3 px-4 text-sm font-medium transition-colors relative ".concat("all"===h?"text-indigo-600 dark:text-indigo-400":"text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-200"),children:["全部 (",r.length,")","all"===h&&(0,s.jsx)(x.E.div,{layoutId:"tab-indicator",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-indigo-600 dark:bg-indigo-400"})]}),(0,s.jsxs)("button",{onClick:()=>u("success"),className:"flex-1 py-3 px-4 text-sm font-medium transition-colors relative ".concat("success"===h?"text-green-600 dark:text-green-400":"text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-200"),children:["成功 (",p.length,")","success"===h&&(0,s.jsx)(x.E.div,{layoutId:"tab-indicator",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-green-600 dark:bg-green-400"})]}),(0,s.jsxs)("button",{onClick:()=>u("error"),className:"flex-1 py-3 px-4 text-sm font-medium transition-colors relative ".concat("error"===h?"text-red-600 dark:text-red-400":"text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-200"),children:["失败 (",b.length,")","error"===h&&(0,s.jsx)(x.E.div,{layoutId:"tab-indicator",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-red-600 dark:bg-red-400"})]})]}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto p-4",children:0===v.length?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center text-slate-500 dark:text-slate-400 p-6",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mb-4 text-slate-300 dark:text-slate-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,s.jsx)("p",{className:"text-lg font-medium mb-2",children:"暂无图片"}),(0,s.jsx)("p",{className:"text-sm",children:"all"===h?"上传完成的图片将会显示在这里":"success"===h?"没有成功上传的图片":"没有上传失败的图片"})]}):(0,s.jsx)("div",{className:"space-y-4",children:(0,s.jsx)("div",{className:"grid grid-cols-2 gap-3",children:v.map((e,t)=>{var r;return(0,s.jsx)(x.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.05*t},className:"relative rounded-lg overflow-hidden border ".concat("success"===e.status?"border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800":"border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/20"," shadow-sm hover:shadow-md transition-all cursor-pointer group"),onClick:()=>"success"===e.status&&w(e),children:"success"===e.status?(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"aspect-square relative bg-slate-50 dark:bg-slate-900",children:[(null===(r=e.urls)||void 0===r?void 0:r.original)&&(0,s.jsx)(g.default,{src:e.urls.original,alt:e.filename,fill:!0,className:"object-cover group-hover:scale-105 transition-transform duration-300",sizes:"(max-width: 768px) 50vw, 33vw"}),(0,s.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),(0,s.jsx)("div",{className:"absolute top-1 right-1",children:(0,s.jsx)("span",{className:"text-xs px-1.5 py-0.5 bg-green-500/80 text-white rounded-full",children:"完成"})}),(0,s.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 p-2 text-white transform translate-y-full group-hover:translate-y-0 transition-transform duration-300",children:[(0,s.jsx)("p",{className:"text-xs truncate",title:e.filename,children:e.filename}),e.expiryTime&&(0,s.jsx)("p",{className:"text-xs mt-1",children:(0,s.jsxs)("span",{className:"bg-yellow-500/80 text-white px-1 py-0.5 rounded text-[10px]",children:["过期时间: ",new Date(e.expiryTime).toLocaleString()]})})]})]})}):(0,s.jsx)("div",{className:"p-3 h-full flex flex-col",children:(0,s.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-red-500 flex-shrink-0 mt-0.5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-sm text-red-600 dark:text-red-400",children:e.filename}),(0,s.jsx)("p",{className:"text-xs text-red-500 dark:text-red-300 mt-1",children:e.message})]})]})})},e.id||"".concat(h,"-").concat(t))})})})})]})}),(0,s.jsx)(k,{image:i,isOpen:d,onClose:()=>{c(!1)},onDelete:l}),(0,s.jsx)(m.M,{children:t&&(0,s.jsx)(x.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/20 dark:bg-black/50 backdrop-blur-sm z-20 sm:block hidden",onClick:o})})]})}let y=parseInt("20",10);function N(){let[e,t]=(0,a.useState)(!1),[r,d]=(0,a.useState)(!1),[c,m]=(0,a.useState)(0),[h,g]=(0,a.useState)(null),[u,w]=(0,a.useState)([]),[f,k]=(0,a.useState)(!1),[N,L]=(0,a.useState)(!1),[C,M]=(0,a.useState)(10);(0,a.useEffect)(()=>{u.length>0&&!f&&k(!0)},[u]),(0,a.useEffect)(()=>{(async()=>{let e=(0,o.Pi)();if(!e){t(!0),L(!1);return}await (0,o.Gw)(e)?L(!0):(t(!0),L(!1),g({type:"error",message:"API Key无效,请重新验证"}))})()},[]),(0,a.useEffect)(()=>{(async()=>{try{let e=await l.hi.request("/api/config");M(e.maxUploadCount)}catch(e){console.error("Failed to fetch config:",e),M(10)}})()},[]);let z=async(e,r,s)=>{if(!(0,o.Pi)()){t(!0);return}d(!0),m(0),g(null);try{let t=setInterval(()=>{m(e=>e>=90?(clearInterval(t),e):e+5)},300),a=new FormData;e.forEach(e=>{a.append("images[]",e)}),a.append("expiryMinutes",r.toString()),s.length>0&&a.append("tags",s.join(","));let o=await l.hi.request("/api/upload",{method:"POST",body:a});clearInterval(t),m(100);let i=o.results.map(e=>{var t,r;let s=Math.random().toString(36).substring(2),a=(null===(t=e.urls)||void 0===t?void 0:t.original)||"";if(null===(r=e.urls)||void 0===r?void 0:r.original){let t=e.urls.original.split("/"),r=t[t.length-1];r.includes(".")&&(s=r.split(".")[0])}return{...e,id:s,path:a}});w(i);let n=i.filter(e=>"success"===e.status).length,d=i.filter(e=>"error"===e.status).length,c=i.length;g({type:0===d?"success":"warning",message:"上传完成：共".concat(c,"张，").concat(n,"张成功，").concat(d,"张失败")})}catch(t){let e="上传失败，请重试";t instanceof Error&&(e=t.message.includes("超过最大上传数量")||t.message.includes("maximum upload")?"上传失败：超过最大上传数量限制（".concat(C,"张图片）"):"上传失败：".concat(t.message)),g({type:"error",message:e})}finally{d(!1),setTimeout(()=>m(0),1e3)}},B=async e=>{try{var t;let r=u.find(t=>t.id===e);if(!r||!(null===(t=r.urls)||void 0===t?void 0:t.original))return;let s=r.urls.original.split("/"),a=s[s.length-1].split(".")[0],o=await l.hi.post("/api/delete-image",{id:a});o.success?(w(t=>t.filter(t=>t.id!==e)),u.length<=1&&k(!1),g({type:"success",message:o.message})):g({type:"error",message:o.message})}catch(e){console.error("删除失败:",e),g({type:"error",message:"删除失败，请重试"})}};return(0,s.jsxs)("div",{className:"max-w-4xl mx-auto px-6 py-8",children:[(0,s.jsx)(n.Z,{onApiKeyClick:()=>t(!0),isKeyVerified:N}),(0,s.jsx)(p,{onUpload:z,isUploading:r,maxUploadCount:y}),h&&(0,s.jsx)(b,{type:h.type,message:h.message}),u.length>0&&!f&&(0,s.jsx)(x.E.button,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},whileHover:{scale:1.1},onClick:()=>k(!0),className:"fixed bottom-6 right-6 bg-indigo-600 dark:bg-indigo-500 text-white rounded-full p-3 shadow-lg hover:shadow-xl transition-all z-20 flex items-center justify-center",title:"查看已上传图片",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z",clipRule:"evenodd"})}),(0,s.jsx)("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:u.length})]})}),r&&(0,s.jsx)(v,{progress:c}),(0,s.jsx)(j,{isOpen:f,results:u,onClose:()=>k(!1),onDelete:B}),(0,s.jsx)(i.Z,{isOpen:e,onClose:()=>t(!1),onSuccess:e=>{(0,o.Lb)(e),t(!1),L(!0),g({type:"success",message:"API Key验证成功！"})}})]})}}},function(e){e.O(0,[654,75,971,117,744],function(){return e(e.s=5140)}),_N_E=e.O()}]);