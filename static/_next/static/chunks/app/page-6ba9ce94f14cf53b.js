(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{5294:function(e,t,s){Promise.resolve().then(s.bind(s,1014))},1227:function(e,t,s){"use strict";s.d(t,{Z:function(){return i}});var r=s(3827),a=s(4090),l=s(5810);function i(e){let{isOpen:t,onClose:s,onSuccess:i}=e,[n,o]=(0,a.useState)(""),[d,c]=(0,a.useState)(!1),[x,h]=(0,a.useState)(""),m=async e=>{e.preventDefault(),c(!0),h("");try{await (0,l.Gw)(n)?i(n):h("API Key无效,请重试")}catch(e){h("验证失败,请重试")}finally{c(!1)}};return t?(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4",children:[(0,r.jsx)("h2",{className:"text-xl font-bold mb-4 text-gray-900 dark:text-white",children:"请输入API Key"}),(0,r.jsxs)("form",{onSubmit:m,children:[(0,r.jsx)("input",{type:"password",value:n,onChange:e=>o(e.target.value),className:"w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:"输入您的API Key",required:!0}),x&&(0,r.jsx)("p",{className:"text-red-500 mb-4",children:x}),(0,r.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,r.jsx)("button",{type:"button",onClick:s,className:"px-4 py-2 text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-white",children:"取消"}),(0,r.jsx)("button",{type:"submit",disabled:d,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50",children:d?"验证中...":"验证"})]})]})]})}):null}},7007:function(e,t,s){"use strict";s.d(t,{F:function(){return a}});var r=s(4090);function a(){let[e,t]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{let e=localStorage.getItem("theme");e&&(t("dark"===e),document.documentElement.classList.toggle("dark","dark"===e))},[]),{isDarkMode:e,toggleTheme:()=>{let s=!e;t(s),localStorage.setItem("theme",s?"dark":"light"),document.documentElement.classList.toggle("dark",s)}}}},1014:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return f}});var r=s(3827),a=s(4090),l=s(5810),i=s(3914),n=s(1227),o=s(8792),d=s(7007);function c(e){let{onApiKeyClick:t}=e,{isDarkMode:s,toggleTheme:a}=(0,d.F)();return(0,r.jsxs)("div",{className:"flex items-center justify-between mb-10",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(o.default,{href:"/",className:"mr-4",children:(0,r.jsx)("div",{className:"bg-gradient-primary w-14 h-14 rounded-2xl flex items-center justify-center shadow-lg transform rotate-12",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})})}),(0,r.jsx)("h1",{className:"text-4xl font-bold bg-clip-text text-transparent bg-gradient-primary",children:"ImageFlow"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(o.default,{href:"/manage",className:"btn-icon",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 6h16M4 10h16M4 14h16M4 18h16"})})}),(0,r.jsx)("button",{onClick:t,className:"btn-icon",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"})})}),(0,r.jsx)("button",{onClick:a,className:"btn-icon",children:s?(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-amber-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})}):(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-gray-700 dark:text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})})})]})]})}var x=s(703);function h(e){let{onUpload:t,isUploading:s}=e,[l,i]=(0,a.useState)([]),[n,o]=(0,a.useState)([]),[d,c]=(0,a.useState)(!1);(0,a.useEffect)(()=>{d&&!s&&(i([]),o([])),c(s)},[s,d]);let h=e=>{let t=n.filter(t=>t.id!==e);o(t),i(l.filter(e=>t.some(t=>t.file===e)))},m=async e=>{e.preventDefault(),0!==l.length&&await t(l)};return(0,r.jsxs)("div",{className:"card p-8 mb-8",children:[(0,r.jsxs)("h2",{className:"text-2xl font-semibold mb-6 flex items-center",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 mr-2 text-indigo-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"上传图片"]}),(0,r.jsxs)("form",{onSubmit:m,children:[(0,r.jsxs)("div",{className:"drop-zone mb-6 flex flex-col items-center justify-center cursor-pointer",onDrop:e=>{e.preventDefault();let t=Array.from(e.dataTransfer.files);i(t);let s=t.map(e=>({id:Math.random().toString(36).substring(2,11),url:"",file:e}));s.forEach((e,s)=>{let r=new FileReader;r.onload=t=>{o(s=>{let r=[...s],a=r.findIndex(t=>t.id===e.id);if(-1!==a){var l;r[a]={...r[a],url:null===(l=t.target)||void 0===l?void 0:l.result}}return r})},r.readAsDataURL(t[s])}),o(s)},onDragOver:e=>{e.preventDefault(),e.currentTarget.classList.add("active")},onDragLeave:e=>{e.preventDefault(),e.currentTarget.classList.remove("active")},children:[(0,r.jsx)("div",{className:"mb-4 bg-indigo-100 dark:bg-indigo-900/50 p-4 rounded-full",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-indigo-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})}),(0,r.jsx)("p",{className:"text-lg font-medium mb-2",children:"拖放多张图片到这里"}),(0,r.jsx)("p",{className:"text-sm text-light-text-secondary dark:text-dark-text-secondary mb-4",children:"或者点击选择文件（可多选）"}),(0,r.jsx)("input",{type:"file",id:"file-input",className:"hidden",accept:"image/*",multiple:!0,onChange:e=>{let t=Array.from(e.target.files||[]);i(t);let s=t.map(e=>({id:Math.random().toString(36).substring(2,11),url:"",file:e}));s.forEach((e,s)=>{let r=new FileReader;r.onload=t=>{o(s=>{let r=[...s],a=r.findIndex(t=>t.id===e.id);if(-1!==a){var l;r[a]={...r[a],url:null===(l=t.target)||void 0===l?void 0:l.result}}return r})},r.readAsDataURL(t[s])}),o(s)}}),(0,r.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=document.getElementById("file-input"))||void 0===e?void 0:e.click()},className:"btn-primary px-4 py-2",children:"选择图片"})]}),n.length>0&&(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,r.jsxs)("h3",{className:"font-medium",children:["已选择 ",n.length," 张图片"]}),(0,r.jsx)("button",{type:"button",onClick:()=>{i([]),o([])},className:"text-sm text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300",children:"清除全部"})]}),(0,r.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3",children:n.map(e=>(0,r.jsxs)("div",{className:"relative group rounded-lg overflow-hidden bg-light-bg-secondary dark:bg-dark-bg-secondary border border-light-border dark:border-dark-border",children:[e.url?(0,r.jsxs)("div",{className:"aspect-square relative",children:[(0,r.jsx)(x.default,{src:e.url,alt:e.file.name,fill:!0,className:"object-cover"}),(0,r.jsx)("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-all duration-200"}),(0,r.jsx)("button",{type:"button",onClick:()=>h(e.id),className:"absolute top-1 right-1 bg-white/80 dark:bg-gray-800/80 rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-700 dark:text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}):(0,r.jsx)("div",{className:"aspect-square flex items-center justify-center bg-gray-100 dark:bg-gray-800",children:(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14"}),(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 5a2 2 0 10-4 0 2 2 0 004 0z"})]})}),(0,r.jsx)("div",{className:"p-2 text-xs truncate",children:e.file.name})]},e.id))})]}),l.length>0&&(0,r.jsx)("button",{type:"submit",disabled:s,className:"w-full py-3 btn-primary disabled:opacity-50",children:s?"上传中...":"上传图片"})]})]})}var m=s(6680);function u(e){let{type:t,message:s}=e;return(0,r.jsx)(m.E.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"mb-8 p-4 rounded-xl ".concat("success"===t?"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300":"warning"===t?"bg-yellow-50 dark:bg-yellow-900/20 text-yellow-700 dark:text-yellow-300":"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-300"),children:s})}function g(e){let{progress:t}=e;return(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"bg-light-bg-primary dark:bg-dark-bg-primary rounded-xl overflow-hidden mb-4",children:(0,r.jsx)("div",{className:"h-2 bg-gradient-primary transition-all duration-300",style:{width:"".concat(t,"%")}})}),(0,r.jsxs)("p",{className:"text-sm text-light-text-secondary dark:text-dark-text-secondary text-center",children:["上传进度: ",Math.round(t),"%"]})]})}var p=s(8745);function v(e){let{isOpen:t,onClose:s,image:l,onDelete:i}=e,[n,o]=(0,a.useState)(null),[d,c]=(0,a.useState)(!1),[h,u]=(0,a.useState)(!1);if(!l||"success"!==l.status||!l.urls)return null;let g=(e,t,s)=>{s&&s.stopPropagation(),navigator.clipboard.writeText(e).then(()=>{o({type:t}),setTimeout(()=>{o(null)},2e3)})},v=e=>e?function(e){if(!e)return"";if(e.startsWith("http://")||e.startsWith("https://"))return e;try{return new URL(e,(0,window.location.origin)).toString()}catch(t){return console.error("URL格式错误:",t),e}}(e):"",w=v(l.urls.original),f=v(l.urls.webp),b=v(l.urls.avif),j=async()=>{if(l&&l.id&&i)try{u(!0),await i(l.id),s()}catch(e){console.error("删除失败:",e)}finally{u(!1)}};return(0,r.jsx)(p.M,{children:t&&(0,r.jsx)(m.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:s,children:(0,r.jsxs)(m.E.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},transition:{type:"spring",damping:25,stiffness:300},className:"bg-white dark:bg-slate-800 rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",onClick:e=>e.stopPropagation(),children:[(0,r.jsxs)("div",{className:"flex justify-between items-center p-4 border-b border-slate-200 dark:border-slate-700",children:[(0,r.jsx)("h3",{className:"text-xl font-semibold",children:l.filename}),(0,r.jsx)("button",{onClick:s,className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-full transition-colors",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),(0,r.jsx)("div",{className:"overflow-y-auto max-h-[calc(90vh-5rem)]",children:(0,r.jsxs)("div",{className:"flex flex-col md:flex-row",children:[(0,r.jsxs)("div",{className:"w-full md:w-2/5 p-4 md:border-r border-slate-200 dark:border-slate-700",children:[(0,r.jsx)(m.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.1},className:"relative aspect-square w-full overflow-hidden rounded-lg border border-slate-200 dark:border-slate-700",children:(0,r.jsx)(x.default,{src:w,alt:l.filename,fill:!0,sizes:"(max-width: 768px) 100vw, 400px",className:"object-contain"})}),(0,r.jsx)("div",{className:"mt-4",children:(0,r.jsxs)("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:["上传时间: ",new Date().toLocaleDateString()]})})]}),(0,r.jsxs)("div",{className:"flex-1 p-4",children:[(0,r.jsx)("h4",{className:"text-lg font-medium mb-4",children:"可用格式"}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)(m.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14"})}),(0,r.jsx)("div",{className:"font-medium",children:"原始图片"})]}),(0,r.jsxs)("div",{className:"rounded-lg bg-slate-100 dark:bg-slate-900 flex items-center group relative hover:bg-slate-200 dark:hover:bg-slate-800/80 transition-colors duration-200",children:[(0,r.jsx)("div",{className:"flex-1 px-4 py-3 text-sm font-mono overflow-hidden text-ellipsis",children:w}),(0,r.jsxs)("button",{onClick:e=>g(w,"original",e),className:"p-3 hover:bg-slate-200 dark:hover:bg-slate-800 rounded-r-lg transition-colors duration-200 relative",title:"复制链接",children:[n&&"original"===n.type?(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}):(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),n&&"original"===n.type&&(0,r.jsx)("span",{className:"absolute -top-8 right-0 bg-black/70 text-white text-xs rounded px-2 py-1",children:"已复制!"})]})]})]}),f&&(0,r.jsxs)(m.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3},children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-purple-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,r.jsx)("div",{className:"font-medium",children:"WebP 格式"})]}),(0,r.jsxs)("div",{className:"rounded-lg bg-slate-100 dark:bg-slate-900 flex items-center group relative hover:bg-slate-200 dark:hover:bg-slate-800/80 transition-colors duration-200",children:[(0,r.jsx)("div",{className:"flex-1 px-4 py-3 text-sm font-mono overflow-hidden text-ellipsis",children:f}),(0,r.jsxs)("button",{onClick:e=>g(f,"webp",e),className:"p-3 hover:bg-slate-200 dark:hover:bg-slate-800 rounded-r-lg transition-colors duration-200 relative",title:"复制链接",children:[n&&"webp"===n.type?(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}):(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),n&&"webp"===n.type&&(0,r.jsx)("span",{className:"absolute -top-8 right-0 bg-black/70 text-white text-xs rounded px-2 py-1",children:"已复制!"})]})]})]}),b&&(0,r.jsxs)(m.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.4},children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,r.jsx)("div",{className:"font-medium",children:"AVIF 格式"})]}),(0,r.jsxs)("div",{className:"rounded-lg bg-slate-100 dark:bg-slate-900 flex items-center group relative hover:bg-slate-200 dark:hover:bg-slate-800/80 transition-colors duration-200",children:[(0,r.jsx)("div",{className:"flex-1 px-4 py-3 text-sm font-mono overflow-hidden text-ellipsis",children:b}),(0,r.jsxs)("button",{onClick:e=>g(b,"avif",e),className:"p-3 hover:bg-slate-200 dark:hover:bg-slate-800 rounded-r-lg transition-colors duration-200 relative",title:"复制链接",children:[n&&"avif"===n.type?(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}):(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),n&&"avif"===n.type&&(0,r.jsx)("span",{className:"absolute -top-8 right-0 bg-black/70 text-white text-xs rounded px-2 py-1",children:"已复制!"})]})]})]}),(0,r.jsxs)(m.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.5},children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-amber-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"})}),(0,r.jsx)("div",{className:"font-medium",children:"Markdown 格式"})]}),(0,r.jsxs)("div",{className:"rounded-lg bg-slate-100 dark:bg-slate-900 flex items-center group relative hover:bg-slate-200 dark:hover:bg-slate-800/80 transition-colors duration-200",children:[(0,r.jsxs)("div",{className:"flex-1 px-4 py-3 text-sm font-mono overflow-hidden text-ellipsis",children:["![",l.filename,"](",w,")"]}),(0,r.jsxs)("button",{onClick:e=>g("![".concat(l.filename,"](").concat(w,")"),"markdown",e),className:"p-3 hover:bg-slate-200 dark:hover:bg-slate-800 rounded-r-lg transition-colors duration-200 relative",title:"复制链接",children:[n&&"markdown"===n.type?(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}):(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),n&&"markdown"===n.type&&(0,r.jsx)("span",{className:"absolute -top-8 right-0 bg-black/70 text-white text-xs rounded px-2 py-1",children:"已复制!"})]})]})]})]})]})]})}),(0,r.jsxs)(m.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.6},className:"p-4 border-t border-slate-200 dark:border-slate-700 flex justify-between",children:[i&&(0,r.jsx)("div",{children:d?(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("button",{onClick:()=>c(!1),className:"px-3 py-2 border border-slate-200 dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors text-sm",disabled:h,children:"取消"}),(0,r.jsx)("button",{onClick:j,className:"px-3 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors text-sm flex items-center",disabled:h,children:h?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"处理中"]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"确认删除"]})})]}):(0,r.jsxs)("button",{onClick:()=>c(!0),className:"px-4 py-2 text-red-600 dark:text-red-400 border border-red-200 dark:border-red-800 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors font-medium flex items-center",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"删除图片"]})}),(0,r.jsx)("button",{onClick:s,className:"px-4 py-2 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 rounded-lg transition-colors font-medium",children:"关闭"})]})]})})})}function w(e){let{isOpen:t,results:s,onClose:l,onDelete:i}=e,[n,o]=(0,a.useState)(null),[d,c]=(0,a.useState)(!1),[h,u]=(0,a.useState)("all"),g=s.filter(e=>"success"===e.status),w=s.filter(e=>"error"===e.status),f="all"===h?s:"success"===h?g:w,b=e=>{o(e),c(!0)};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(p.M,{children:t&&(0,r.jsxs)(m.E.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"spring",damping:30,stiffness:300},className:"fixed top-0 right-0 w-full sm:w-96 h-full bg-white dark:bg-slate-900 shadow-xl z-30 border-l border-slate-200 dark:border-slate-700 overflow-hidden flex flex-col",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-700 bg-gradient-to-r from-indigo-500 to-purple-600 text-white",children:[(0,r.jsxs)("h2",{className:"text-lg font-semibold flex items-center",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2 text-white opacity-90",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z",clipRule:"evenodd"})}),"媒体库 (",s.length,")"]}),(0,r.jsx)("button",{onClick:l,className:"p-2 rounded-full hover:bg-white/10 transition-colors",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),(0,r.jsxs)("div",{className:"flex border-b border-slate-200 dark:border-slate-700",children:[(0,r.jsxs)("button",{onClick:()=>u("all"),className:"flex-1 py-3 px-4 text-sm font-medium transition-colors relative ".concat("all"===h?"text-indigo-600 dark:text-indigo-400":"text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-200"),children:["全部 (",s.length,")","all"===h&&(0,r.jsx)(m.E.div,{layoutId:"tab-indicator",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-indigo-600 dark:bg-indigo-400"})]}),(0,r.jsxs)("button",{onClick:()=>u("success"),className:"flex-1 py-3 px-4 text-sm font-medium transition-colors relative ".concat("success"===h?"text-green-600 dark:text-green-400":"text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-200"),children:["成功 (",g.length,")","success"===h&&(0,r.jsx)(m.E.div,{layoutId:"tab-indicator",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-green-600 dark:bg-green-400"})]}),(0,r.jsxs)("button",{onClick:()=>u("error"),className:"flex-1 py-3 px-4 text-sm font-medium transition-colors relative ".concat("error"===h?"text-red-600 dark:text-red-400":"text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-200"),children:["失败 (",w.length,")","error"===h&&(0,r.jsx)(m.E.div,{layoutId:"tab-indicator",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-red-600 dark:bg-red-400"})]})]}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto p-4",children:0===f.length?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center text-slate-500 dark:text-slate-400 p-6",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mb-4 text-slate-300 dark:text-slate-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,r.jsx)("p",{className:"text-lg font-medium mb-2",children:"暂无图片"}),(0,r.jsx)("p",{className:"text-sm",children:"all"===h?"上传完成的图片将会显示在这里":"success"===h?"没有成功上传的图片":"没有上传失败的图片"})]}):(0,r.jsx)("div",{className:"space-y-4",children:(0,r.jsx)("div",{className:"grid grid-cols-2 gap-3",children:f.map((e,t)=>{var s;return(0,r.jsx)(m.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.05*t},className:"relative rounded-lg overflow-hidden border ".concat("success"===e.status?"border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800":"border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/20"," shadow-sm hover:shadow-md transition-all cursor-pointer group"),onClick:()=>"success"===e.status&&b(e),children:"success"===e.status?(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{className:"aspect-square relative bg-slate-50 dark:bg-slate-900",children:[(null===(s=e.urls)||void 0===s?void 0:s.original)&&(0,r.jsx)(x.default,{src:e.urls.original,alt:e.filename,fill:!0,className:"object-cover group-hover:scale-105 transition-transform duration-300",sizes:"(max-width: 768px) 50vw, 33vw"}),(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),(0,r.jsx)("div",{className:"absolute top-1 right-1",children:(0,r.jsx)("span",{className:"text-xs px-1.5 py-0.5 bg-green-500/80 text-white rounded-full",children:"完成"})}),(0,r.jsx)("div",{className:"absolute bottom-0 left-0 right-0 p-2 text-white transform translate-y-full group-hover:translate-y-0 transition-transform duration-300",children:(0,r.jsx)("p",{className:"text-xs truncate",title:e.filename,children:e.filename})})]})}):(0,r.jsx)("div",{className:"p-3 h-full flex flex-col",children:(0,r.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-red-500 flex-shrink-0 mt-0.5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium text-sm text-red-600 dark:text-red-400",children:e.filename}),(0,r.jsx)("p",{className:"text-xs text-red-500 dark:text-red-300 mt-1",children:e.message})]})]})})},e.id||"".concat(h,"-").concat(t))})})})})]})}),(0,r.jsx)(v,{image:n,isOpen:d,onClose:()=>{c(!1)},onDelete:i}),(0,r.jsx)(p.M,{children:t&&(0,r.jsx)(m.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/20 dark:bg-black/50 backdrop-blur-sm z-20 sm:block hidden",onClick:l})})]})}function f(){let[e,t]=(0,a.useState)(!1),[s,o]=(0,a.useState)(!1),[d,x]=(0,a.useState)(0),[p,v]=(0,a.useState)(null),[f,b]=(0,a.useState)([]),[j,k]=(0,a.useState)(!1);(0,a.useEffect)(()=>{f.length>0&&!j&&k(!0)},[f]),(0,a.useEffect)(()=>{(async()=>{let e=(0,l.Pi)();if(!e){t(!0);return}await (0,l.Gw)(e)||(t(!0),v({type:"error",message:"API Key无效,请重新验证"}))})()},[]);let y=async e=>{if(!(0,l.Pi)()){t(!0);return}o(!0),x(0);try{let t=setInterval(()=>{x(e=>e>=90?(clearInterval(t),e):e+5)},300),s=await i.hi.upload("/upload",e);clearInterval(t),x(100);let r=s.results.map(e=>{var t;return{...e,id:Math.random().toString(36).substring(2),path:(null===(t=e.urls)||void 0===t?void 0:t.original)||""}});b(r);let a=r.filter(e=>"success"===e.status).length,l=r.filter(e=>"error"===e.status).length,n=r.length;v({type:0===l?"success":"warning",message:"上传完成：共".concat(n,"张，").concat(a,"张成功，").concat(l,"张失败")})}catch(e){v({type:"error",message:"上传失败，请重试"})}finally{o(!1),setTimeout(()=>x(0),1e3)}},N=async e=>{try{return b(t=>t.filter(t=>t.id!==e)),f.length<=1&&k(!1),v({type:"success",message:"图片已成功删除"}),Promise.resolve()}catch(e){return v({type:"error",message:"删除图片失败，请重试"}),Promise.reject()}};return(0,r.jsxs)("div",{className:"max-w-4xl mx-auto px-6 py-8",children:[(0,r.jsx)(c,{onApiKeyClick:()=>t(!0)}),(0,r.jsx)(h,{onUpload:y,isUploading:s}),p&&(0,r.jsx)(u,{type:p.type,message:p.message}),f.length>0&&!j&&(0,r.jsx)(m.E.button,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},whileHover:{scale:1.1},onClick:()=>k(!0),className:"fixed bottom-6 right-6 bg-indigo-600 dark:bg-indigo-500 text-white rounded-full p-3 shadow-lg hover:shadow-xl transition-all z-20 flex items-center justify-center",title:"查看已上传图片",children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z",clipRule:"evenodd"})}),(0,r.jsx)("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:f.length})]})}),s&&(0,r.jsx)(g,{progress:d}),(0,r.jsx)(w,{isOpen:j,results:f,onClose:()=>k(!1),onDelete:N}),(0,r.jsx)(n.Z,{isOpen:e,onClose:()=>t(!1),onSuccess:e=>{(0,l.Lb)(e),t(!1),v({type:"success",message:"API Key验证成功！"})}})]})}},5810:function(e,t,s){"use strict";s.d(t,{Gw:function(){return i},Lb:function(){return l},Pi:function(){return a}});let r="imageflow_api_key",a=()=>localStorage.getItem(r),l=e=>{localStorage.setItem(r,e)},i=async e=>{try{let t=await fetch("".concat("","/validate-api-key"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}),s=await t.json();return!0===s.valid}catch(e){return console.error("API Key validation error:",e),!1}}},3914:function(e,t,s){"use strict";s.d(t,{hi:function(){return l}});var r=s(5810);async function a(e){let t,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=(0,r.Pi)();if(!a)throw Error("未设置API Key");let{params:l,...i}=s;try{t=new URL(e,window.location.origin)}catch(s){t=new URL(e,window.location.origin)}l&&Object.entries(l).forEach(e=>{let[s,r]=e;t.searchParams.append(s,r)});let n={Authorization:"Bearer ".concat(a),...s.headers},o=await fetch(t.toString(),{...i,headers:n});if(!o.ok)throw Error((await o.json().catch(()=>({}))).message||"请求失败");return o.json()}let l={get:(e,t)=>a(e,{method:"GET",params:t}),post:(e,t)=>a(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),delete:e=>a(e,{method:"DELETE"}),upload:(e,t)=>{let s=new FormData;return t.forEach(e=>{s.append("images[]",e)}),a(e,{method:"POST",body:s})}}}},function(e){e.O(0,[142,971,69,744],function(){return e(e.s=5294)}),_N_E=e.O()}]);